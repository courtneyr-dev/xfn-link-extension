(()=>{"use strict";const e=window.wp.i18n,n=window.wp.hooks,t=window.wp.components,i=window.wp.blockEditor,o=window.wp.compose,s=window.wp.element,l=(window.wp.data,window.wp.primitives),a=window.ReactJSXRuntime;var r=(0,a.jsx)(l.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)(l.Path,{d:"M6.5 12.4L12 8l5.5 4.4-.9 1.2L12 10l-4.5 3.6-1-1.2z"})}),c=(0,a.jsx)(l.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)(l.Path,{d:"M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"})}),p=(0,a.jsx)(l.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,a.jsx)(l.Path,{d:"M10 17.389H8.444A5.194 5.194 0 1 1 8.444 7H10v1.5H8.444a3.694 3.694 0 0 0 0 7.389H10v1.5ZM14 7h1.556a5.194 5.194 0 0 1 0 10.39H14v-1.5h1.556a3.694 3.694 0 0 0 0-7.39H14V7Zm-4.5 6h5v-1.5h-5V13Z"})});const d={friendship:{type:"radio",label:(0,e.__)("Friendship","xfn-relationship-link-extension"),description:(0,e.__)("Your friendship level (choose one)","xfn-relationship-link-extension"),options:[{label:(0,e.__)("Contact","xfn-relationship-link-extension"),value:"contact"},{label:(0,e.__)("Acquaintance","xfn-relationship-link-extension"),value:"acquaintance"},{label:(0,e.__)("Friend","xfn-relationship-link-extension"),value:"friend"}]},physical:{type:"checkbox",label:(0,e.__)("Physical","xfn-relationship-link-extension"),description:(0,e.__)("Have you met this person?","xfn-relationship-link-extension"),options:[{label:(0,e.__)("Met","xfn-relationship-link-extension"),value:"met"}]},professional:{type:"checkbox",label:(0,e.__)("Professional","xfn-relationship-link-extension"),description:(0,e.__)("Professional relationships","xfn-relationship-link-extension"),options:[{label:(0,e.__)("Co-worker","xfn-relationship-link-extension"),value:"co-worker"},{label:(0,e.__)("Colleague","xfn-relationship-link-extension"),value:"colleague"}]},geographical:{type:"radio",label:(0,e.__)("Geographical","xfn-relationship-link-extension"),description:(0,e.__)("Geographical relationship","xfn-relationship-link-extension"),options:[{label:(0,e.__)("Co-resident","xfn-relationship-link-extension"),value:"co-resident"},{label:(0,e.__)("Neighbor","xfn-relationship-link-extension"),value:"neighbor"}]},family:{type:"radio",label:(0,e.__)("Family","xfn-relationship-link-extension"),description:(0,e.__)("Family relationship","xfn-relationship-link-extension"),options:[{label:(0,e.__)("Child","xfn-relationship-link-extension"),value:"child"},{label:(0,e.__)("Parent","xfn-relationship-link-extension"),value:"parent"},{label:(0,e.__)("Sibling","xfn-relationship-link-extension"),value:"sibling"},{label:(0,e.__)("Spouse","xfn-relationship-link-extension"),value:"spouse"},{label:(0,e.__)("Kin","xfn-relationship-link-extension"),value:"kin"}]},romantic:{type:"checkbox",label:(0,e.__)("Romantic","xfn-relationship-link-extension"),description:(0,e.__)("Romantic relationships","xfn-relationship-link-extension"),options:[{label:(0,e.__)("Muse","xfn-relationship-link-extension"),value:"muse"},{label:(0,e.__)("Crush","xfn-relationship-link-extension"),value:"crush"},{label:(0,e.__)("Date","xfn-relationship-link-extension"),value:"date"},{label:(0,e.__)("Sweetheart","xfn-relationship-link-extension"),value:"sweetheart"}]},identity:{type:"checkbox",label:(0,e.__)("Identity","xfn-relationship-link-extension"),description:(0,e.__)("Is this your own content?","xfn-relationship-link-extension"),options:[{label:(0,e.__)("Me","xfn-relationship-link-extension"),value:"me"}]}};function u(e){if(!e)return{xfn:[],other:[]};const n=["contact","acquaintance","friend","met","co-worker","colleague","co-resident","neighbor","child","parent","sibling","spouse","kin","muse","crush","date","sweetheart","me"],t=e.split(/\s+/).filter(Boolean),i=[],o=[];return t.forEach(e=>{n.includes(e)?i.push(e):o.push(e)}),{xfn:i,other:o}}function x(e,n){const t=[...n,...e].filter(Boolean);return[...new Set(t)].join(" ")}function h(e,n){return e.rel?e.rel:e.metadata?.rel?e.metadata.rel:""}function f(e,n,t,i){e.hasOwnProperty("rel")?n({rel:t||void 0}):n({metadata:{...e.metadata||{},rel:t||void 0}})}const b=({currentRel:n,onUpdateRel:i,isExpanded:o,onToggle:s})=>{const{xfn:l,other:p}=u(n),h=(e,n,t)=>{let o=[...l];if("radio"===d[e].type){const i=d[e].options.map(e=>e.value);o=o.filter(e=>!i.includes(e)),t&&o.push(n)}else t?o.includes(n)||o.push(n):o=o.filter(e=>e!==n);const s=x(o,p);i(s)};return(0,a.jsxs)("div",{className:"xfn-collapsible-section",children:[(0,a.jsxs)(t.Button,{className:"xfn-section-toggle",onClick:s,"aria-expanded":o,icon:o?r:c,iconPosition:"right",variant:"tertiary",children:[(0,e.__)("XFN","xfn-relationship-link-extension"),l.length>0&&(0,a.jsx)("span",{className:"xfn-count-badge",children:l.length})]}),o&&(0,a.jsxs)("div",{className:"xfn-section-content",children:[(0,a.jsx)("p",{className:"xfn-section-description",children:(0,e.__)("Describe your relationship to this person or organization","xfn-relationship-link-extension")}),(0,a.jsx)("div",{className:"xfn-relationships",children:Object.entries(d).map(([n,i])=>{if("radio"===i.type){const o=i.options.find(e=>l.includes(e.value))?.value||"";return(0,a.jsxs)("div",{className:"xfn-category",children:[(0,a.jsx)("h4",{children:i.label}),(0,a.jsxs)(t.ButtonGroup,{children:[(0,a.jsx)(t.Button,{isPressed:""===o,onClick:()=>h(n,"",!0),size:"compact",children:(0,e.__)("None","xfn-relationship-link-extension")}),i.options.map(e=>(0,a.jsx)(t.Button,{isPressed:o===e.value,onClick:()=>h(n,e.value,!0),size:"compact",children:e.label},e.value))]})]},n)}return(0,a.jsxs)("div",{className:"xfn-category",children:[(0,a.jsx)("h4",{children:i.label}),(0,a.jsx)(t.ButtonGroup,{children:i.options.map(e=>(0,a.jsx)(t.Button,{isPressed:l.includes(e.value),onClick:()=>h(n,e.value,!l.includes(e.value)),size:"compact",children:e.label},e.value))})]},n)})}),l.length>0&&(0,a.jsxs)("div",{className:"xfn-summary",children:[(0,a.jsx)("h4",{children:(0,e.__)("Active Relationships:","xfn-relationship-link-extension")}),(0,a.jsx)("div",{className:"xfn-pills",children:l.map(e=>(0,a.jsx)("span",{className:`xfn-pill xfn-pill-${e}`,children:e},e))})]})]})]})},v=({isVisible:n,onClose:i,currentRel:o,onUpdateRel:l,anchorRef:r})=>{const[c,p]=(0,s.useState)(!1);return n?(0,a.jsx)(t.Popover,{position:"bottom center",onClose:i,anchorRef:r?.current,className:"xfn-toolbar-popover",focusOnMount:"firstElement",children:(0,a.jsxs)("div",{className:"xfn-toolbar-popover-content",children:[(0,a.jsx)("div",{className:"xfn-toolbar-header",children:(0,a.jsx)("h3",{children:(0,e.__)("Link Settings","xfn-relationship-link-extension")})}),(0,a.jsx)(b,{currentRel:o,onUpdateRel:l,isExpanded:c,onToggle:()=>p(!c)})]})}):null},m=({attributes:n,setAttributes:o,name:s})=>{const l=h(n),{xfn:r,other:c}=u(l),p=(e,t,i)=>{let s=[...r];if("radio"===d[e].type){const n=d[e].options.map(e=>e.value);s=s.filter(e=>!n.includes(e)),i&&s.push(t)}else i?s.includes(t)||s.push(t):s=s.filter(e=>e!==t);(e=>{const t=x(e,c);f(n,o,t)})(s)};return(0,a.jsx)(i.InspectorControls,{children:(0,a.jsxs)(t.PanelBody,{title:(0,e.__)("XFN Relationships","xfn-relationship-link-extension"),initialOpen:!1,className:"xfn-inspector-panel",children:[(0,a.jsx)("p",{className:"xfn-panel-description",children:(0,e.__)("Describe your relationship to the people or organizations you link to using XFN (XHTML Friends Network) markup.","xfn-relationship-link-extension")}),Object.entries(d).map(([n,i])=>{if("radio"===i.type){const o=i.options.find(e=>r.includes(e.value))?.value||"",s=[{label:(0,e.__)("None","xfn-relationship-link-extension"),value:""},...i.options];return(0,a.jsx)("div",{className:"xfn-category-section",children:(0,a.jsx)(t.RadioControl,{label:i.label,help:i.description,selected:o,options:s,onChange:e=>{p(n,e,""!==e)}})},n)}return(0,a.jsxs)("div",{className:"xfn-category-section",children:[(0,a.jsx)("h4",{className:"xfn-category-title",children:i.label}),(0,a.jsx)("p",{className:"xfn-category-help",children:i.description}),i.options.map(e=>(0,a.jsx)(t.CheckboxControl,{label:e.label,checked:r.includes(e.value),onChange:t=>{p(n,e.value,t)}},e.value))]},n)}),r.length>0&&(0,a.jsxs)("div",{className:"xfn-selected-summary",children:[(0,a.jsx)("h4",{children:(0,e.__)("Selected Relationships:","xfn-relationship-link-extension")}),(0,a.jsx)("div",{className:"xfn-pills",children:r.map(e=>(0,a.jsx)("span",{className:`xfn-pill xfn-pill-${e}`,children:e},e))})]})]})})};let _=[],k=[];function g(){setTimeout(()=>{const n=document.querySelector(".block-editor-link-control");if(!n)return;const t=n.querySelector(".block-editor-link-control__tools .components-button");if(!t)return;if("true"!==t.getAttribute("aria-expanded"))return;const i=n.querySelector(".block-editor-link-control__settings");if(!i)return;if(i.querySelector(".xfn-collapsible-section"))return;const o=n.querySelector('input[type="text"][placeholder*="rel"], input[id*="rel"]'),s=o?o.value:"",{xfn:l,other:a}=u(s);_=[...l],k=[...a];const r=document.createElement("div");r.className="xfn-collapsible-section",r.innerHTML=function(n){let t=`\n\t\t<button \n\t\t\tclass="xfn-section-toggle components-button is-tertiary" \n\t\t\taria-expanded="false" \n\t\t\ttype="button"\n\t\t>\n\t\t\tXFN ${n.length>0?`<span class="xfn-count-badge">${n.length}</span>`:""}\n\t\t\t<svg class="xfn-chevron" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"/>\n\t\t\t</svg>\n\t\t</button>\n\t\t<div class="xfn-section-content" style="display: none;">\n\t\t\t<p class="xfn-section-description">\n\t\t\t\t${(0,e.__)("Describe your relationship to this person or organization","xfn-relationship-link-extension")}\n\t\t\t</p>\n\t`;return Object.entries(d).forEach(([i,o])=>{if(t+=`<div class="xfn-category" data-category="${i}">`,t+=`<h4>${o.label}</h4>`,"radio"===o.type){const i=o.options.find(e=>n.includes(e.value))?.value||"";t+='<div class="xfn-button-group">',t+=`<button class="components-button is-compact ${""===i?"is-pressed":""}" data-value="">${(0,e.__)("None","xfn-relationship-link-extension")}</button>`,o.options.forEach(e=>{t+=`<button class="components-button is-compact ${i===e.value?"is-pressed":""}" data-value="${e.value}">${e.label}</button>`}),t+="</div>"}else t+='<div class="xfn-button-group">',o.options.forEach(e=>{const i=n.includes(e.value);t+=`<button class="components-button is-compact ${i?"is-pressed":""}" data-value="${e.value}">${e.label}</button>`}),t+="</div>";t+="</div>"}),n.length>0&&(t+='<div class="xfn-summary">',t+=`<h4>${(0,e.__)("Active Relationships:","xfn-relationship-link-extension")}</h4>`,t+='<div class="xfn-pills">',n.forEach(e=>{t+=`<span class="xfn-pill xfn-pill-${e}">${e}</span>`}),t+="</div></div>"),t+="</div>",t}(_),i.appendChild(r),function(n,t){const i=n.querySelector(".xfn-section-toggle"),o=n.querySelector(".xfn-section-content"),s=i.querySelector(".xfn-chevron");i.addEventListener("click",e=>{e.preventDefault();const n=!("true"===i.getAttribute("aria-expanded"));i.setAttribute("aria-expanded",n),o.style.display=n?"block":"none",s.style.transform=n?"rotate(180deg)":"rotate(0deg)"}),n.querySelectorAll(".xfn-button-group .components-button").forEach(o=>{o.addEventListener("click",o=>{o.preventDefault();const s=o.target.closest(".xfn-category").dataset.category,l=o.target.dataset.value,a=o.target.closest(".xfn-button-group");if("radio"===d[s].type){const e=d[s].options.map(e=>e.value);_=_.filter(n=>!e.includes(n)),l&&_.push(l),a.querySelectorAll(".components-button").forEach(e=>{e.classList.remove("is-pressed")}),o.target.classList.add("is-pressed")}else o.target.classList.contains("is-pressed")?(_=_.filter(e=>e!==l),o.target.classList.remove("is-pressed")):(_.includes(l)||_.push(l),o.target.classList.add("is-pressed"));(()=>{const o=x(_,k);t&&(t.value=o,t.dispatchEvent(new Event("input",{bubbles:!0}))),function(n){let t=n.querySelector(".xfn-summary");if(0===_.length)return void(t&&t.remove());t||(t=document.createElement("div"),t.className="xfn-summary",n.querySelector(".xfn-section-content").appendChild(t));let i=`<h4>${(0,e.__)("Active Relationships:","xfn-relationship-link-extension")}</h4>`;i+='<div class="xfn-pills">',_.forEach(e=>{i+=`<span class="xfn-pill xfn-pill-${e}">${e}</span>`}),i+="</div>",t.innerHTML=i}(n),function(e){let n=e.querySelector(".xfn-count-badge");0!==_.length?(n||(n=document.createElement("span"),n.className="xfn-count-badge",e.insertBefore(n,e.querySelector(".xfn-chevron"))),n.textContent=_.length):n&&n.remove()}(i)})()})})}(r,o)},100)}const y=(0,o.createHigherOrderComponent)(n=>o=>{const{attributes:l,name:r}=o,[c,d]=(0,s.useState)(!1),u=(0,s.useState)(null);if(!(["core/button","core/image","core/navigation-link","core/site-logo","core/post-title","core/query-title"].includes(r)||l.hasOwnProperty("url")||l.hasOwnProperty("href")||l.hasOwnProperty("linkDestination")))return(0,a.jsx)(n,{...o});const x=h(l);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n,{...o}),(0,a.jsx)(m,{...o}),(0,a.jsx)(i.BlockControls,{children:(0,a.jsx)(t.Button,{ref:u[0],icon:p,label:(0,e.__)("XFN Relationships","xfn-relationship-link-extension"),onClick:()=>d(!c),isPressed:c,className:"xfn-toolbar-button",children:(0,e.__)("XFN","xfn-relationship-link-extension")})}),(0,a.jsx)(v,{isVisible:c,onClose:()=>d(!1),currentRel:x,onUpdateRel:e=>{f(l,o.setAttributes,e)},anchorRef:u[0]})]})},"withXFNControls");(0,n.addFilter)("editor.BlockEdit","xfn-link-extension/with-xfn-controls",y),"undefined"!=typeof document&&setTimeout(function(){new MutationObserver(e=>{e.forEach(e=>{"childList"===e.type&&Array.from(e.addedNodes).forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&((e.classList?.contains("block-editor-link-control")||e.querySelector?.(".block-editor-link-control"))&&g(),(e.classList?.contains("block-editor-link-control__settings")||e.querySelector?.(".block-editor-link-control__settings"))&&g())}),"attributes"===e.type&&"aria-expanded"===e.attributeName&&g()})}).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["aria-expanded"]}),document.addEventListener("click",e=>{e.target.closest(".block-editor-link-control__tools .components-button")&&setTimeout(g,50)})},1e3),console.log("XFN Link Extension loaded successfully! XFN controls will appear:"),console.log("1. In the floating toolbar for link blocks (Button, Navigation, etc.)"),console.log("2. In Inspector Controls for link blocks"),console.log("3. In a collapsible XFN section in link popovers for inline links")})();