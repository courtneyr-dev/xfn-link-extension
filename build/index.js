(()=>{"use strict";const e=window.wp.i18n,n=window.wp.hooks,t=window.wp.components,o=window.wp.blockEditor,i=window.wp.compose,s=window.wp.element,l=(window.wp.data,window.wp.primitives),a=window.ReactJSXRuntime,r=(0,a.jsx)(l.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)(l.Path,{d:"M6.5 12.4L12 8l5.5 4.4-.9 1.2L12 10l-4.5 3.6-1-1.2z"})}),c=(0,a.jsx)(l.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)(l.Path,{d:"M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"})}),d=(0,a.jsx)(l.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,a.jsx)(l.Path,{d:"M10 17.389H8.444A5.194 5.194 0 1 1 8.444 7H10v1.5H8.444a3.694 3.694 0 0 0 0 7.389H10v1.5ZM14 7h1.556a5.194 5.194 0 0 1 0 10.39H14v-1.5h1.556a3.694 3.694 0 0 0 0-7.39H14V7Zm-4.5 6h5v-1.5h-5V13Z"})}),u={friendship:{type:"radio",label:(0,e.__)("Friendship","xfn-link-extension"),description:(0,e.__)("Your friendship level (choose one)","xfn-link-extension"),options:[{label:(0,e.__)("Contact","xfn-link-extension"),value:"contact"},{label:(0,e.__)("Acquaintance","xfn-link-extension"),value:"acquaintance"},{label:(0,e.__)("Friend","xfn-link-extension"),value:"friend"}]},physical:{type:"checkbox",label:(0,e.__)("Physical","xfn-link-extension"),description:(0,e.__)("Have you met this person?","xfn-link-extension"),options:[{label:(0,e.__)("Met","xfn-link-extension"),value:"met"}]},professional:{type:"checkbox",label:(0,e.__)("Professional","xfn-link-extension"),description:(0,e.__)("Professional relationships","xfn-link-extension"),options:[{label:(0,e.__)("Co-worker","xfn-link-extension"),value:"co-worker"},{label:(0,e.__)("Colleague","xfn-link-extension"),value:"colleague"}]},geographical:{type:"radio",label:(0,e.__)("Geographical","xfn-link-extension"),description:(0,e.__)("Geographical relationship","xfn-link-extension"),options:[{label:(0,e.__)("Co-resident","xfn-link-extension"),value:"co-resident"},{label:(0,e.__)("Neighbor","xfn-link-extension"),value:"neighbor"}]},family:{type:"radio",label:(0,e.__)("Family","xfn-link-extension"),description:(0,e.__)("Family relationship","xfn-link-extension"),options:[{label:(0,e.__)("Child","xfn-link-extension"),value:"child"},{label:(0,e.__)("Parent","xfn-link-extension"),value:"parent"},{label:(0,e.__)("Sibling","xfn-link-extension"),value:"sibling"},{label:(0,e.__)("Spouse","xfn-link-extension"),value:"spouse"},{label:(0,e.__)("Kin","xfn-link-extension"),value:"kin"}]},romantic:{type:"checkbox",label:(0,e.__)("Romantic","xfn-link-extension"),description:(0,e.__)("Romantic relationships","xfn-link-extension"),options:[{label:(0,e.__)("Muse","xfn-link-extension"),value:"muse"},{label:(0,e.__)("Crush","xfn-link-extension"),value:"crush"},{label:(0,e.__)("Date","xfn-link-extension"),value:"date"},{label:(0,e.__)("Sweetheart","xfn-link-extension"),value:"sweetheart"}]},identity:{type:"checkbox",label:(0,e.__)("Identity","xfn-link-extension"),description:(0,e.__)("Is this your own content?","xfn-link-extension"),options:[{label:(0,e.__)("Me","xfn-link-extension"),value:"me"}]}};function x(e){if(!e)return{xfn:[],other:[]};const n=["contact","acquaintance","friend","met","co-worker","colleague","co-resident","neighbor","child","parent","sibling","spouse","kin","muse","crush","date","sweetheart","me"],t=e.split(/\s+/).filter(Boolean),o=[],i=[];return t.forEach(e=>{n.includes(e)?o.push(e):i.push(e)}),{xfn:o,other:i}}function p(e,n){const t=[...n,...e].filter(Boolean);return[...new Set(t)].join(" ")}function f(e,n){return e.rel?e.rel:e.metadata?.rel?e.metadata.rel:""}function h(e,n,t,o){e.hasOwnProperty("rel")?n({rel:t||void 0}):n({metadata:{...e.metadata||{},rel:t||void 0}})}const b=({currentRel:n,onUpdateRel:o,isExpanded:i,onToggle:s})=>{const{xfn:l,other:d}=x(n),f=(e,n,t)=>{let i=[...l];if("radio"===u[e].type){const o=u[e].options.map(e=>e.value);i=i.filter(e=>!o.includes(e)),t&&i.push(n)}else t?i.includes(n)||i.push(n):i=i.filter(e=>e!==n);const s=p(i,d);o(s)};return(0,a.jsxs)("div",{className:"xfn-collapsible-section",children:[(0,a.jsxs)(t.Button,{className:"xfn-section-toggle",onClick:s,"aria-expanded":i,icon:i?r:c,iconPosition:"right",variant:"tertiary",children:[(0,e.__)("XFN","xfn-link-extension"),l.length>0&&(0,a.jsx)("span",{className:"xfn-count-badge",children:l.length})]}),i&&(0,a.jsxs)("div",{className:"xfn-section-content",children:[(0,a.jsx)("p",{className:"xfn-section-description",children:(0,e.__)("Describe your relationship to this person or organization","xfn-link-extension")}),(0,a.jsx)("div",{className:"xfn-relationships",children:Object.entries(u).map(([n,o])=>{if("radio"===o.type){const i=o.options.find(e=>l.includes(e.value))?.value||"";return(0,a.jsxs)("div",{className:"xfn-category",children:[(0,a.jsx)("h4",{children:o.label}),(0,a.jsxs)(t.ButtonGroup,{children:[(0,a.jsx)(t.Button,{isPressed:""===i,onClick:()=>f(n,"",!0),size:"compact",children:(0,e.__)("None","xfn-link-extension")}),o.options.map(e=>(0,a.jsx)(t.Button,{isPressed:i===e.value,onClick:()=>f(n,e.value,!0),size:"compact",children:e.label},e.value))]})]},n)}return(0,a.jsxs)("div",{className:"xfn-category",children:[(0,a.jsx)("h4",{children:o.label}),(0,a.jsx)(t.ButtonGroup,{children:o.options.map(e=>(0,a.jsx)(t.Button,{isPressed:l.includes(e.value),onClick:()=>f(n,e.value,!l.includes(e.value)),size:"compact",children:e.label},e.value))})]},n)})}),l.length>0&&(0,a.jsxs)("div",{className:"xfn-summary",children:[(0,a.jsx)("h4",{children:(0,e.__)("Active Relationships:","xfn-link-extension")}),(0,a.jsx)("div",{className:"xfn-pills",children:l.map(e=>(0,a.jsx)("span",{className:`xfn-pill xfn-pill-${e}`,children:e},e))})]})]})]})},v=({isVisible:n,onClose:o,currentRel:i,onUpdateRel:l,anchorRef:r})=>{const[c,d]=(0,s.useState)(!1);return n?(0,a.jsx)(t.Popover,{position:"bottom center",onClose:o,anchorRef:r?.current,className:"xfn-toolbar-popover",focusOnMount:"firstElement",children:(0,a.jsxs)("div",{className:"xfn-toolbar-popover-content",children:[(0,a.jsx)("div",{className:"xfn-toolbar-header",children:(0,a.jsx)("h3",{children:(0,e.__)("Link Settings","xfn-link-extension")})}),(0,a.jsx)(b,{currentRel:i,onUpdateRel:l,isExpanded:c,onToggle:()=>d(!c)})]})}):null},m=({attributes:n,setAttributes:i,name:s})=>{const l=f(n),{xfn:r,other:c}=x(l),d=(e,t,o)=>{let s=[...r];if("radio"===u[e].type){const n=u[e].options.map(e=>e.value);s=s.filter(e=>!n.includes(e)),o&&s.push(t)}else o?s.includes(t)||s.push(t):s=s.filter(e=>e!==t);(e=>{const t=p(e,c);h(n,i,t)})(s)};return(0,a.jsx)(o.InspectorControls,{children:(0,a.jsxs)(t.PanelBody,{title:(0,e.__)("XFN Relationships","xfn-link-extension"),initialOpen:!1,className:"xfn-inspector-panel",children:[(0,a.jsx)("p",{className:"xfn-panel-description",children:(0,e.__)("Describe your relationship to the people or organizations you link to using XFN (XHTML Friends Network) markup.","xfn-link-extension")}),Object.entries(u).map(([n,o])=>{if("radio"===o.type){const i=o.options.find(e=>r.includes(e.value))?.value||"",s=[{label:(0,e.__)("None","xfn-link-extension"),value:""},...o.options];return(0,a.jsx)("div",{className:"xfn-category-section",children:(0,a.jsx)(t.RadioControl,{label:o.label,help:o.description,selected:i,options:s,onChange:e=>{d(n,e,""!==e)}})},n)}return(0,a.jsxs)("div",{className:"xfn-category-section",children:[(0,a.jsx)("h4",{className:"xfn-category-title",children:o.label}),(0,a.jsx)("p",{className:"xfn-category-help",children:o.description}),o.options.map(e=>(0,a.jsx)(t.CheckboxControl,{label:e.label,checked:r.includes(e.value),onChange:t=>{d(n,e.value,t)}},e.value))]},n)}),r.length>0&&(0,a.jsxs)("div",{className:"xfn-selected-summary",children:[(0,a.jsx)("h4",{children:(0,e.__)("Selected Relationships:","xfn-link-extension")}),(0,a.jsx)("div",{className:"xfn-pills",children:r.map(e=>(0,a.jsx)("span",{className:`xfn-pill xfn-pill-${e}`,children:e},e))})]})]})})};let _=[],k=[];function g(){setTimeout(()=>{const n=document.querySelector(".block-editor-link-control");if(!n)return;const t=n.querySelector(".block-editor-link-control__tools .components-button");if(!t)return;if("true"!==t.getAttribute("aria-expanded"))return;const o=n.querySelector(".block-editor-link-control__settings");if(!o)return;if(o.querySelector(".xfn-collapsible-section"))return;const i=n.querySelector('input[type="text"][placeholder*="rel"], input[id*="rel"]'),s=i?i.value:"",{xfn:l,other:a}=x(s);_=[...l],k=[...a];const r=document.createElement("div");r.className="xfn-collapsible-section",r.innerHTML=function(n){let t=`\n\t\t<button \n\t\t\tclass="xfn-section-toggle components-button is-tertiary" \n\t\t\taria-expanded="false" \n\t\t\ttype="button"\n\t\t>\n\t\t\tXFN ${n.length>0?`<span class="xfn-count-badge">${n.length}</span>`:""}\n\t\t\t<svg class="xfn-chevron" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"/>\n\t\t\t</svg>\n\t\t</button>\n\t\t<div class="xfn-section-content" style="display: none;">\n\t\t\t<p class="xfn-section-description">\n\t\t\t\t${(0,e.__)("Describe your relationship to this person or organization","xfn-link-extension")}\n\t\t\t</p>\n\t`;return Object.entries(u).forEach(([o,i])=>{if(t+=`<div class="xfn-category" data-category="${o}">`,t+=`<h4>${i.label}</h4>`,"radio"===i.type){const o=i.options.find(e=>n.includes(e.value))?.value||"";t+='<div class="xfn-button-group">',t+=`<button class="components-button is-compact ${""===o?"is-pressed":""}" data-value="">${(0,e.__)("None","xfn-link-extension")}</button>`,i.options.forEach(e=>{t+=`<button class="components-button is-compact ${o===e.value?"is-pressed":""}" data-value="${e.value}">${e.label}</button>`}),t+="</div>"}else t+='<div class="xfn-button-group">',i.options.forEach(e=>{const o=n.includes(e.value);t+=`<button class="components-button is-compact ${o?"is-pressed":""}" data-value="${e.value}">${e.label}</button>`}),t+="</div>";t+="</div>"}),n.length>0&&(t+='<div class="xfn-summary">',t+=`<h4>${(0,e.__)("Active Relationships:","xfn-link-extension")}</h4>`,t+='<div class="xfn-pills">',n.forEach(e=>{t+=`<span class="xfn-pill xfn-pill-${e}">${e}</span>`}),t+="</div></div>"),t+="</div>",t}(_),o.appendChild(r),function(n,t){const o=n.querySelector(".xfn-section-toggle"),i=n.querySelector(".xfn-section-content"),s=o.querySelector(".xfn-chevron");o.addEventListener("click",e=>{e.preventDefault();const n=!("true"===o.getAttribute("aria-expanded"));o.setAttribute("aria-expanded",n),i.style.display=n?"block":"none",s.style.transform=n?"rotate(180deg)":"rotate(0deg)"}),n.querySelectorAll(".xfn-button-group .components-button").forEach(i=>{i.addEventListener("click",i=>{i.preventDefault();const s=i.target.closest(".xfn-category").dataset.category,l=i.target.dataset.value,a=i.target.closest(".xfn-button-group");if("radio"===u[s].type){const e=u[s].options.map(e=>e.value);_=_.filter(n=>!e.includes(n)),l&&_.push(l),a.querySelectorAll(".components-button").forEach(e=>{e.classList.remove("is-pressed")}),i.target.classList.add("is-pressed")}else i.target.classList.contains("is-pressed")?(_=_.filter(e=>e!==l),i.target.classList.remove("is-pressed")):(_.includes(l)||_.push(l),i.target.classList.add("is-pressed"));(()=>{const i=p(_,k);t&&(t.value=i,t.dispatchEvent(new Event("input",{bubbles:!0}))),function(n){let t=n.querySelector(".xfn-summary");if(0===_.length)return void(t&&t.remove());t||(t=document.createElement("div"),t.className="xfn-summary",n.querySelector(".xfn-section-content").appendChild(t));let o=`<h4>${(0,e.__)("Active Relationships:","xfn-link-extension")}</h4>`;o+='<div class="xfn-pills">',_.forEach(e=>{o+=`<span class="xfn-pill xfn-pill-${e}">${e}</span>`}),o+="</div>",t.innerHTML=o}(n),function(e){let n=e.querySelector(".xfn-count-badge");0!==_.length?(n||(n=document.createElement("span"),n.className="xfn-count-badge",e.insertBefore(n,e.querySelector(".xfn-chevron"))),n.textContent=_.length):n&&n.remove()}(o)})()})})}(r,i)},100)}const y=(0,i.createHigherOrderComponent)(n=>i=>{const{attributes:l,name:r}=i,[c,u]=(0,s.useState)(!1),x=(0,s.useState)(null);if(!(["core/button","core/image","core/navigation-link","core/site-logo","core/post-title","core/query-title"].includes(r)||l.hasOwnProperty("url")||l.hasOwnProperty("href")||l.hasOwnProperty("linkDestination")))return(0,a.jsx)(n,{...i});const p=f(l);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n,{...i}),(0,a.jsx)(m,{...i}),(0,a.jsx)(o.BlockControls,{children:(0,a.jsx)(t.Button,{ref:x[0],icon:d,label:(0,e.__)("XFN Relationships","xfn-link-extension"),onClick:()=>u(!c),isPressed:c,className:"xfn-toolbar-button",children:(0,e.__)("XFN","xfn-link-extension")})}),(0,a.jsx)(v,{isVisible:c,onClose:()=>u(!1),currentRel:p,onUpdateRel:e=>{h(l,i.setAttributes,e)},anchorRef:x[0]})]})},"withXFNControls");(0,n.addFilter)("editor.BlockEdit","xfn-link-extension/with-xfn-controls",y),"undefined"!=typeof document&&setTimeout(function(){new MutationObserver(e=>{e.forEach(e=>{"childList"===e.type&&Array.from(e.addedNodes).forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&((e.classList?.contains("block-editor-link-control")||e.querySelector?.(".block-editor-link-control"))&&g(),(e.classList?.contains("block-editor-link-control__settings")||e.querySelector?.(".block-editor-link-control__settings"))&&g())}),"attributes"===e.type&&"aria-expanded"===e.attributeName&&g()})}).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["aria-expanded"]}),document.addEventListener("click",e=>{e.target.closest(".block-editor-link-control__tools .components-button")&&setTimeout(g,50)})},1e3),console.log("XFN Link Extension loaded successfully! XFN controls will appear:"),console.log("1. In the floating toolbar for link blocks (Button, Navigation, etc.)"),console.log("2. In Inspector Controls for link blocks"),console.log("3. In a collapsible XFN section in link popovers for inline links")})();