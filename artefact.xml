<?xml version="1.0"?><artefact xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="artefact.xsd" name="XFN Relationship Link Extension" slug="xfn-link-extension" type="code-package" schemaVersion="2">
  <file path="readme.txt">
    <description>This file contains the readme information for the XFN relationship link extension plugin. It provides comprehensive information about the plugin, its usage, XFN vocabulary, and integration details.</description>
    <content><![CDATA[=== XFN Relationship Link Extension ===

Contributors:      WordPress Telex
Tags:              xfn, links, relationships, accessibility, gutenberg
Tested up to:      6.8
Stable tag:        1.0.0
License:           GPLv2 or later
License URI:       https://www.gnu.org/licenses/gpl-2.0.html
Requires at least: 6.4
Requires PHP:      7.4

Extends the native Gutenberg link interface to include XFN (XHTML Friends Network) relationship options with a collapsible interface across all blocks that support links.

== Description ==

The XFN Relationship Link Extension seamlessly integrates XFN (XHTML Friends Network) relationship options into WordPress's native link interface. This plugin enhances every block that supports links—including Paragraph, Button, Navigation, List, and more—with comprehensive relationship tagging capabilities through an intuitive collapsible interface.

XFN is a simple way to represent human relationships using hyperlinks. By adding XFN relationships to your links, you can indicate how you're connected to the people and organizations you link to, creating a more semantic and meaningful web.

## Key Features

### Complete XFN 1.1 Specification Support
This plugin implements the full XFN 1.1 specification with all relationship categories:

* **Friendship relationships**: contact, acquaintance, friend
* **Physical relationships**: met (have you met this person?)
* **Professional relationships**: co-worker, colleague
* **Geographical relationships**: co-resident, neighbor
* **Family relationships**: child, parent, sibling, spouse, kin
* **Romantic relationships**: muse, crush, date, sweetheart
* **Identity relationships**: me (link to yourself)

### Triple Interface Integration with Collapsible Design
The plugin provides XFN controls in three convenient locations, all featuring a clean collapsible interface:

* **Floating Toolbar**: Click the "XFN" button in the block toolbar for direct access with expandable XFN section
* **Inspector Controls**: Traditional WordPress panel in the block sidebar with full XFN categorization
* **Link Advanced Panel**: Collapsible XFN section alongside existing link options in popovers

### Seamless Integration with WordPress
The plugin extends the existing link interfaces without disrupting your workflow:

* Works with Paragraph, Button, Navigation, List, and all other link-supporting blocks
* Compatible with both Post Editor and Site Editor
* Preserves existing rel attributes (nofollow, noopener, noreferrer)
* No configuration required - works immediately after activation
* Clean collapsible interface matches WordPress design patterns

### Advanced User Interface with Collapsible Sections
The relationship selection interface is designed for optimal usability with modern collapsible design:

* **Collapsible XFN sections**: Clean toggle buttons with expand/collapse animation
* **Visual relationship pills**: Color-coded indicators show active relationships at a glance
* **Count badges**: Quickly see how many relationships are active without expanding
* **Intelligent grouping**: Related options are logically organized by category within sections
* **Button groups**: Modern toggle-style buttons for easy relationship selection
* **Mutual exclusivity**: Button groups prevent conflicting relationships (e.g., can't be both "friend" and "acquaintance")
* **Multi-selection support**: Checkbox-style groups allow multiple compatible relationships
* **Real-time validation**: Prevents invalid relationship combinations
* **Smooth animations**: Fluid expand/collapse transitions

### Accessibility Excellence
Built with accessibility as a priority:

* **Full keyboard navigation**: Tab, arrow keys, and standard shortcuts work throughout
* **Collapsible accessibility**: Proper ARIA attributes for expand/collapse states
* **Screen reader support**: Comprehensive ARIA labels and descriptions for all states
* **High contrast compatibility**: Tested with Windows High Contrast mode
* **Focus management**: Clear visual focus indicators and logical tab order
* **WCAG 2.2 AA compliance**: Meets and exceeds accessibility standards

## How to Add XFN Relationships to Links

### Method 1: Using the Floating Toolbar (Recommended)
1. Select a block that contains a link (Button, Navigation Link, etc.)
2. Look for the "XFN" button in the floating block toolbar
3. Click the XFN button to open the relationship selector popover
4. Click the "XFN" toggle to expand the collapsible section
5. Choose your relationships using the button groups within categories
6. Active relationships appear as colored pills in the summary
7. Click outside the popover to save your changes

### Method 2: Using Inspector Controls
1. Select a block that contains a link
2. Open the block settings panel (sidebar)
3. Find the "XFN Relationships" panel and expand it
4. Select relationships using radio buttons and checkboxes organized by category
5. View active relationships in the summary section with color-coded pills

### Method 3: Using Link Advanced Panel with Collapsible XFN
1. Create or edit an inline link in any block (Paragraph, List, etc.)
2. In the link popover, click "Advanced" to expand additional options
3. Find the "XFN" collapsible section and click to expand
4. Select relationships using the organized button groups
5. See your active relationships in the summary pills
6. Save the link to apply your XFN relationships

## Understanding XFN Relationship Categories

### Friendship Relationships (Choose One)
These are mutually exclusive - you can only select one friendship level per person:

* **contact**: Someone you know how to get in touch with
* **acquaintance**: Someone you've met but don't know well
* **friend**: Someone you consider a friend

### Physical Meeting
* **met**: Check this if you've met this person face-to-face

### Professional Relationships (Multiple Allowed)
* **co-worker**: Someone you work with at the same company
* **colleague**: Someone in your professional field or industry

### Geographical Relationships (Choose One)
* **co-resident**: Someone who lives in the same residence
* **neighbor**: Someone who lives nearby

### Family Relationships (Choose One)
* **child**: Your child
* **parent**: Your parent
* **sibling**: Your brother or sister
* **spouse**: Your husband, wife, or domestic partner
* **kin**: Other family relation

### Romantic Relationships (Multiple Allowed)
* **muse**: Someone who inspires you
* **crush**: Someone you have romantic feelings for
* **date**: Someone you're dating
* **sweetheart**: Someone you have a romantic relationship with

### Identity
* **me**: A link to your own content or profiles

## Integration with Popular Blocks

### Button Block
Use the floating toolbar XFN button for quick relationship assignment. The collapsible interface lets you quickly expand the XFN section, select relationships, and see a summary without clutter.

### Navigation Block
Enhance your site navigation with relationship context using the Inspector Controls. Mark links to your social profiles, partner sites, or affiliated organizations with the organized collapsible interface.

### Paragraph Block (Inline Links)
For inline links within paragraph content, use the collapsible XFN section in the link popover's Advanced area to add relationship context without overwhelming the interface.

### List Block
Build relationship-rich link lists using either the floating toolbar or Inspector Controls. The collapsible sections make it easy to manage multiple relationships across list items.

### Cover Block and Media & Text Block
Add relationship context to overlay links and media-associated links using any of the three interface methods, all featuring the clean collapsible design.

## Technical Implementation

### Rel Attribute Management
The plugin intelligently manages the HTML rel attribute:

* Combines XFN relationships with existing rel values
* Preserves SEO-important attributes like nofollow
* Maintains security attributes like noopener and noreferrer
* Uses space-separated format per HTML specification
* Validates relationship combinations to prevent conflicts

### Data Persistence
* Relationships are stored in the standard HTML rel attribute
* No custom database tables or meta fields required
* Compatible with all WordPress import/export tools
* Relationships survive theme changes and plugin deactivation

### Performance Optimized
* Lightweight JavaScript bundle under 12KB gzipped
* Lazy-loaded collapsible sections only when accessed
* No impact on frontend performance
* Uses WordPress core components for consistency
* Smooth animations without performance penalties

## Migration from Other XFN Plugins

If you're migrating from another XFN plugin:

1. **Classic Editor plugins**: Existing XFN data in post meta will be preserved
2. **Custom rel attributes**: Any existing rel values are maintained
3. **Manual XFN**: Manually entered XFN relationships in rel attributes work immediately

## Frequently Asked Questions

### Where can I access XFN relationship options?

XFN controls are available in three locations, all featuring collapsible interfaces:
1. **Floating Toolbar**: Click the "XFN" button in the block toolbar, then expand the XFN section
2. **Inspector Controls**: In the block settings sidebar under "XFN Relationships" panel
3. **Link Advanced Panel**: In the Advanced section of inline link popovers as a collapsible "XFN" section

### Why use a collapsible interface?

The collapsible design keeps the interface clean and uncluttered while providing full access to XFN features:
* **Count badges** show active relationships at a glance
* **Expand only when needed** to reduce visual noise
* **Consistent with WordPress design** patterns
* **Accessible** with proper ARIA states
* **Mobile friendly** with touch-optimized toggles

### What is XFN and why should I use it?

XFN (XHTML Friends Network) is a simple way to represent human relationships using hyperlinks. It adds semantic meaning to your links by describing how you're connected to the people and organizations you link to. This creates a richer, more meaningful web where relationships between people and content are explicit.

### Does the collapsible interface affect accessibility?

No, the collapsible interface enhances accessibility by:
* **Reducing cognitive load** by showing only relevant information
* **Providing proper ARIA states** for screen readers
* **Supporting full keyboard navigation** including expand/collapse
* **Maintaining focus management** when sections open and close
* **Offering visual and semantic cues** about content state

### Does this affect my SEO or page speed?

No negative impact on either. The plugin adds standard HTML rel attributes that search engines understand. The JavaScript only loads in the WordPress editor, not on your public pages. The collapsible interface has no impact on frontend performance.

### Can I use this with Classic Editor?

This plugin is designed for the Gutenberg block editor (WordPress 5.0+). For Classic Editor, you would need a different XFN plugin or manually add rel attributes to your links.

### What happens if I deactivate the plugin?

Your XFN relationships remain in your content as standard rel attributes. They just won't be editable through the collapsible user interface anymore. Your content is never damaged or modified.

### Can I control which sections are expanded by default?

Currently, all collapsible sections start in the collapsed state to maintain a clean interface. We're considering user preferences for default states in future versions.

### Does this work with all themes?

Yes! XFN relationships are standard HTML attributes that work with any theme. The editing interface uses WordPress core components and follows WordPress design patterns for consistency across all admin themes.

### Can I customize the collapsible behavior?

The current version provides the standard collapsible behavior. We're considering customization options for animation speed and default states based on user feedback.

### Is this compatible with page builders?

This plugin works with the native WordPress block editor. Compatibility with third-party page builders depends on whether they use WordPress's standard link interface and support collapsible components.

### How do I see the XFN relationships on my published pages?

XFN relationships appear in the HTML rel attribute of links. You can view them by inspecting the page source or using browser developer tools. They're primarily for semantic markup rather than visual display.

### Can I use this for business relationships?

Absolutely! XFN includes professional relationships (co-worker, colleague) and can be used to indicate business partnerships, vendor relationships, and professional networks. The collapsible interface makes it easy to manage multiple professional relationships.

## Troubleshooting

### XFN options don't appear in floating toolbar

1. **Check block type**: Only blocks that are entirely links (Button, Navigation Link, etc.) show the XFN toolbar button
2. **Verify WordPress version**: Requires WordPress 6.4 or later
3. **Clear browser cache**: Try refreshing the page or clearing browser cache
4. **Check for block selection**: Ensure the block is properly selected

### XFN section won't expand in link popover

1. **Check Advanced section**: XFN options appear when you click "Advanced" in the link popover, then look for the "XFN" toggle
2. **Try clicking the toggle**: The XFN section requires an additional click to expand
3. **Verify in block editor**: Plugin only works with Gutenberg blocks, not Classic Editor
4. **Check browser console**: Look for JavaScript errors that might prevent interaction

### Collapsible sections not animating smoothly

1. **Check browser compatibility**: Ensure you're using a modern, supported browser
2. **Verify CSS loading**: Check that plugin stylesheets are loading properly
3. **Test in incognito mode**: Rule out browser extension interference
4. **Disable other plugins**: Test for plugin conflicts by temporarily disabling other plugins

### Count badges not updating

1. **Try refreshing**: Sometimes a page refresh resolves display issues
2. **Check JavaScript console**: Look for errors that might prevent updates
3. **Test relationship changes**: Make sure you're actually changing relationships
4. **Verify plugin activation**: Ensure the plugin is properly activated

### Relationships not saving properly

1. **Check browser console**: Look for JavaScript errors that might prevent saving
2. **Verify user permissions**: Ensure you have permission to edit the content
3. **Test with default theme**: Temporarily switch to a default WordPress theme
4. **Disable other plugins**: Test for plugin conflicts by temporarily disabling other plugins

### Keyboard navigation issues with collapsible sections

1. **Test tab order**: Use Tab key to navigate to toggle buttons
2. **Try space/enter**: Space or Enter should expand/collapse sections
3. **Use arrow keys**: Arrow keys work within expanded button groups
4. **Check browser settings**: Ensure keyboard navigation is enabled in browser settings

### Screen reader compatibility with collapsible interface

1. **Test with multiple screen readers**: NVDA, JAWS, and VoiceOver are all supported
2. **Check expansion announcements**: Section state changes should be announced
3. **Verify ARIA states**: All collapsible elements should have proper ARIA attributes
4. **Update screen reader**: Ensure you're using a current version of your screen reader

## Changelog

= 1.0.0 =
* Initial release with full XFN 1.1 specification support
* Triple interface integration: Floating Toolbar, Inspector Controls, and Link Advanced Panel
* Modern collapsible interface design with smooth animations
* Count badges for quick relationship status overview
* Seamless integration with WordPress native link interface
* Complete accessibility implementation with WCAG 2.2 AA compliance
* Support for all link-supporting blocks in Gutenberg editor
* Visual relationship pills with color-coded categories
* Intelligent mutual exclusivity and multi-selection handling
* Comprehensive keyboard navigation and screen reader support
* Collapsible sections with proper ARIA states and focus management
* Performance optimized with lazy loading and minimal bundle size
* Preservation of existing rel attributes (nofollow, noopener)
* Extensive internationalization with translation-ready strings
* Responsive design with mobile-friendly collapsible toggles
* High contrast mode support for enhanced accessibility

== Installation ==

1. Upload the plugin files to the `/wp-content/plugins/xfn-link-extension` directory, or install the plugin through the WordPress plugins screen directly.
2. Activate the plugin through the 'Plugins' screen in WordPress
3. No configuration required - XFN options will immediately appear in:
   - The floating toolbar for link blocks (Button, Navigation, etc.) with an expandable XFN section
   - The Inspector Controls sidebar for supported blocks with organized panels
   - The Advanced section of link popovers for inline links as a collapsible XFN section
4. Start adding relationship context to your links using the intuitive collapsible interface across all blocks that support links

== Screenshots ==

1. XFN button in floating block toolbar with collapsible relationship interface
2. Inspector Controls panel showing comprehensive XFN relationship options with categorized sections
3. Link Advanced panel integration with collapsible XFN section alongside existing options
4. Collapsed XFN section showing count badge for quick status overview
5. Expanded XFN section with button groups for relationship selection
6. Visual relationship pills showing active selections with color coding in summary
7. Complete relationship overview with collapsible categories in popover interface
8. Navigation block with XFN relationships using clean collapsible design for enhanced semantic linking]]></content>
  </file>
  <file path="xfn-link-extension.php">
    <description>Main plugin file that handles registration, asset enqueuing, and core functionality for the XFN link extension plugin.</description>
    <content><![CDATA[<?php
/**
 * Plugin Name:       XFN Relationship Link Extension
 * Plugin URI:        https://github.com/automattic/xfn-link-extension
 * Description:       Extends the native Gutenberg link interface to include XFN (XHTML Friends Network) relationship options across all blocks that support links. Features floating toolbar access, Inspector Controls integration, and Link Advanced panel support.
 * Version:           1.0.0
 * Requires at least: 6.4
 * Requires PHP:      7.4
 * Author:            WordPress Telex
 * License:           GPLv2 or later
 * License URI:       https://www.gnu.org/licenses/gpl-2.0.html
 * Text Domain:       xfn-link-extension
 * Domain Path:       /languages
 *
 * @package XFNLinkExtension
 */

// Prevent direct access
if ( ! defined( 'ABSPATH' ) ) {
	exit;
}

// Define plugin constants
define( 'XFN_LINK_EXTENSION_VERSION', '1.0.0' );
define( 'XFN_LINK_EXTENSION_PLUGIN_FILE', __FILE__ );
define( 'XFN_LINK_EXTENSION_PLUGIN_URL', plugin_dir_url( __FILE__ ) );
define( 'XFN_LINK_EXTENSION_PLUGIN_PATH', plugin_dir_path( __FILE__ ) );

/**
 * XFN Link Extension main class
 *
 * Handles plugin initialization, asset enqueuing, and core functionality
 * for extending WordPress link interface with XFN relationship options
 * across multiple interface points: floating toolbar, inspector controls,
 * and link advanced panel.
 *
 * @since 1.0.0
 */
class XFN_Link_Extension {

	/**
	 * Plugin instance
	 *
	 * @var XFN_Link_Extension
	 */
	private static $instance = null;

	/**
	 * Get plugin instance
	 *
	 * @return XFN_Link_Extension
	 */
	public static function get_instance() {
		if ( null === self::$instance ) {
			self::$instance = new self();
		}
		return self::$instance;
	}

	/**
	 * Constructor
	 *
	 * Initialize plugin hooks and functionality.
	 */
	private function __construct() {
		add_action( 'init', array( $this, 'init' ) );
		add_action( 'enqueue_block_editor_assets', array( $this, 'enqueue_block_editor_assets' ) );
		
		// Load plugin text domain for internationalization
		add_action( 'plugins_loaded', array( $this, 'load_textdomain' ) );
	}

	/**
	 * Initialize plugin
	 *
	 * Runs after WordPress has finished loading but before any headers are sent.
	 * Sets up plugin functionality and registers necessary components.
	 *
	 * @since 1.0.0
	 */
	public function init() {
		// Add REST API endpoint for XFN validation (if needed in future)
		// This would be used for server-side validation of relationship combinations
	}

	/**
	 * Load plugin text domain for internationalization
	 *
	 * Loads translation files from the /languages directory.
	 * Supports both plugin directory and WordPress core language directory.
	 *
	 * @since 1.0.0
	 */
	public function load_textdomain() {
		load_plugin_textdomain(
			'xfn-link-extension',
			false,
			dirname( plugin_basename( XFN_LINK_EXTENSION_PLUGIN_FILE ) ) . '/languages'
		);
	}

	/**
	 * Enqueue block editor assets
	 *
	 * Loads JavaScript and CSS files needed for the block editor interface.
	 * Only loads in the block editor context to avoid frontend performance impact.
	 *
	 * @since 1.0.0
	 */
	public function enqueue_block_editor_assets() {
		// Enqueue main JavaScript file
		wp_enqueue_script(
			'xfn-link-extension',
			XFN_LINK_EXTENSION_PLUGIN_URL . 'build/index.js',
			array(
				'wp-blocks',
				'wp-element',
				'wp-components',
				'wp-data',
				'wp-hooks',
				'wp-i18n',
				'wp-rich-text',
				'wp-block-editor',
				'wp-compose',
			),
			XFN_LINK_EXTENSION_VERSION,
			true
		);

		// Enqueue editor-specific styles
		wp_enqueue_style(
			'xfn-link-extension-editor',
			XFN_LINK_EXTENSION_PLUGIN_URL . 'build/editor.css',
			array( 'wp-components' ),
			XFN_LINK_EXTENSION_VERSION
		);

		// Localize script with XFN relationship data and translations
		wp_localize_script(
			'xfn-link-extension',
			'xfnLinkExtension',
			array(
				'relationships' => $this->get_xfn_relationships(),
				'version' => XFN_LINK_EXTENSION_VERSION,
				'nonce' => wp_create_nonce( 'xfn_link_extension' ),
				'interfaces' => array(
					'toolbar' => __( 'Floating Toolbar', 'xfn-link-extension' ),
					'inspector' => __( 'Inspector Controls', 'xfn-link-extension' ),
					'advanced' => __( 'Link Advanced Panel', 'xfn-link-extension' ),
				),
			)
		);

		// Set script translations for JavaScript
		wp_set_script_translations(
			'xfn-link-extension',
			'xfn-link-extension',
			XFN_LINK_EXTENSION_PLUGIN_PATH . 'languages'
		);
	}

	/**
	 * Get XFN relationship definitions
	 *
	 * Returns the complete XFN 1.1 specification as a structured array.
	 * Includes all relationship categories with their types and validation rules.
	 *
	 * @since 1.0.0
	 * @return array XFN relationship structure
	 */
	private function get_xfn_relationships() {
		return array(
			'friendship' => array(
				'type' => 'radio',
				'label' => __( 'Friendship', 'xfn-link-extension' ),
				'description' => __( 'Your friendship level with this person (choose one)', 'xfn-link-extension' ),
				'options' => array(
					'contact' => __( 'Contact', 'xfn-link-extension' ),
					'acquaintance' => __( 'Acquaintance', 'xfn-link-extension' ),
					'friend' => __( 'Friend', 'xfn-link-extension' ),
				),
				'default' => null,
			),
			'physical' => array(
				'type' => 'checkbox',
				'label' => __( 'Physical', 'xfn-link-extension' ),
				'description' => __( 'Have you met this person in real life?', 'xfn-link-extension' ),
				'options' => array(
					'met' => __( 'Met', 'xfn-link-extension' ),
				),
			),
			'professional' => array(
				'type' => 'checkbox',
				'label' => __( 'Professional', 'xfn-link-extension' ),
				'description' => __( 'Professional relationships (multiple allowed)', 'xfn-link-extension' ),
				'options' => array(
					'co-worker' => __( 'Co-worker', 'xfn-link-extension' ),
					'colleague' => __( 'Colleague', 'xfn-link-extension' ),
				),
			),
			'geographical' => array(
				'type' => 'radio',
				'label' => __( 'Geographical', 'xfn-link-extension' ),
				'description' => __( 'Your geographical relationship (choose one)', 'xfn-link-extension' ),
				'options' => array(
					'co-resident' => __( 'Co-resident', 'xfn-link-extension' ),
					'neighbor' => __( 'Neighbor', 'xfn-link-extension' ),
				),
				'default' => null,
			),
			'family' => array(
				'type' => 'radio',
				'label' => __( 'Family', 'xfn-link-extension' ),
				'description' => __( 'Family relationship (choose one)', 'xfn-link-extension' ),
				'options' => array(
					'child' => __( 'Child', 'xfn-link-extension' ),
					'parent' => __( 'Parent', 'xfn-link-extension' ),
					'sibling' => __( 'Sibling', 'xfn-link-extension' ),
					'spouse' => __( 'Spouse', 'xfn-link-extension' ),
					'kin' => __( 'Kin', 'xfn-link-extension' ),
				),
				'default' => null,
			),
			'romantic' => array(
				'type' => 'checkbox',
				'label' => __( 'Romantic', 'xfn-link-extension' ),
				'description' => __( 'Romantic relationships (multiple allowed)', 'xfn-link-extension' ),
				'options' => array(
					'muse' => __( 'Muse', 'xfn-link-extension' ),
					'crush' => __( 'Crush', 'xfn-link-extension' ),
					'date' => __( 'Date', 'xfn-link-extension' ),
					'sweetheart' => __( 'Sweetheart', 'xfn-link-extension' ),
				),
			),
			'identity' => array(
				'type' => 'checkbox',
				'label' => __( 'Identity', 'xfn-link-extension' ),
				'description' => __( 'Is this link to your own content?', 'xfn-link-extension' ),
				'options' => array(
					'me' => __( 'Me', 'xfn-link-extension' ),
				),
			),
		);
	}

	/**
	 * Parse rel attribute to separate XFN and non-XFN values
	 *
	 * Takes a rel attribute string and separates XFN relationships from
	 * other rel values like nofollow, noopener, etc.
	 *
	 * @since 1.0.0
	 * @param string $rel_string The rel attribute value to parse
	 * @return array Array with 'xfn' and 'other' keys containing respective values
	 */
	public static function parse_rel_attribute( $rel_string ) {
		if ( empty( $rel_string ) ) {
			return array( 'xfn' => array(), 'other' => array() );
		}

		// All possible XFN relationship values
		$xfn_values = array(
			'contact', 'acquaintance', 'friend', 'met',
			'co-worker', 'colleague', 'co-resident', 'neighbor',
			'child', 'parent', 'sibling', 'spouse', 'kin',
			'muse', 'crush', 'date', 'sweetheart', 'me'
		);

		$rel_parts = array_filter( array_map( 'trim', explode( ' ', $rel_string ) ) );
		$xfn = array();
		$other = array();

		foreach ( $rel_parts as $part ) {
			if ( in_array( $part, $xfn_values, true ) ) {
				$xfn[] = $part;
			} else {
				$other[] = $part;
			}
		}

		return array(
			'xfn' => $xfn,
			'other' => $other,
		);
	}

	/**
	 * Combine XFN and other rel values into valid rel attribute string
	 *
	 * Takes XFN relationships and other rel values and combines them
	 * into a properly formatted rel attribute string.
	 *
	 * @since 1.0.0
	 * @param array $xfn_values Array of XFN relationship values
	 * @param array $other_values Array of non-XFN rel values
	 * @return string Combined rel attribute value
	 */
	public static function combine_rel_values( $xfn_values, $other_values ) {
		$all_values = array_merge(
			array_filter( (array) $other_values ),
			array_filter( (array) $xfn_values )
		);

		// Remove duplicates and empty values
		$all_values = array_unique( array_filter( $all_values ) );

		return implode( ' ', $all_values );
	}

	/**
	 * Validate XFN relationship combinations
	 *
	 * Ensures that selected XFN relationships are valid according to
	 * the XFN specification. Checks for mutually exclusive relationships.
	 *
	 * @since 1.0.0
	 * @param array $relationships Array of selected XFN relationships
	 * @return bool Whether the relationship combination is valid
	 */
	public static function validate_xfn_relationships( $relationships ) {
		if ( empty( $relationships ) || ! is_array( $relationships ) ) {
			return true;
		}

		// Define mutually exclusive groups
		$exclusive_groups = array(
			array( 'contact', 'acquaintance', 'friend' ),
			array( 'co-resident', 'neighbor' ),
			array( 'child', 'parent', 'sibling', 'spouse', 'kin' ),
		);

		// Check each exclusive group
		foreach ( $exclusive_groups as $group ) {
			$selected_in_group = array_intersect( $relationships, $group );
			if ( count( $selected_in_group ) > 1 ) {
				return false;
			}
		}

		return true;
	}

	/**
	 * Sanitize XFN rel attribute value
	 *
	 * Cleans and validates a rel attribute value to ensure it contains
	 * only valid XFN and standard rel values.
	 *
	 * @since 1.0.0
	 * @param string $rel_value The rel attribute value to sanitize
	 * @return string Sanitized rel attribute value
	 */
	public static function sanitize_rel_attribute( $rel_value ) {
		if ( empty( $rel_value ) ) {
			return '';
		}

		// Parse the rel attribute
		$parsed = self::parse_rel_attribute( $rel_value );
		
		// Validate XFN relationships
		if ( ! self::validate_xfn_relationships( $parsed['xfn'] ) ) {
			// If invalid, remove all XFN values and keep only other values
			$parsed['xfn'] = array();
		}

		// Combine and return
		return self::combine_rel_values( $parsed['xfn'], $parsed['other'] );
	}
}

/**
 * Initialize the plugin
 */
function xfn_link_extension_init() {
	XFN_Link_Extension::get_instance();
}
add_action( 'plugins_loaded', 'xfn_link_extension_init' );

/**
 * Plugin activation hook
 *
 * Runs when the plugin is activated. Performs any necessary setup.
 *
 * @since 1.0.0
 */
function xfn_link_extension_activate() {
	// Check minimum requirements
	if ( version_compare( get_bloginfo( 'version' ), '6.4', '<' ) ) {
		deactivate_plugins( plugin_basename( __FILE__ ) );
		wp_die(
			esc_html__( 'XFN Link Extension requires WordPress 6.4 or higher.', 'xfn-link-extension' ),
			esc_html__( 'Plugin Activation Error', 'xfn-link-extension' ),
			array( 'back_link' => true )
		);
	}

	if ( version_compare( PHP_VERSION, '7.4', '<' ) ) {
		deactivate_plugins( plugin_basename( __FILE__ ) );
		wp_die(
			esc_html__( 'XFN Link Extension requires PHP 7.4 or higher.', 'xfn-link-extension' ),
			esc_html__( 'Plugin Activation Error', 'xfn-link-extension' ),
			array( 'back_link' => true )
		);
	}
}
register_activation_hook( __FILE__, 'xfn_link_extension_activate' );

/**
 * Helper function to get XFN relationship definitions
 *
 * Provides a public interface for accessing XFN relationship structure.
 * Useful for themes or other plugins that need to work with XFN data.
 *
 * @since 1.0.0
 * @return array XFN relationship definitions
 */
function xfn_get_relationships() {
	$instance = XFN_Link_Extension::get_instance();
	return $instance->get_xfn_relationships();
}

/**
 * Helper function to parse rel attributes
 *
 * Provides a public interface for parsing rel attribute strings.
 *
 * @since 1.0.0
 * @param string $rel_string The rel attribute value to parse
 * @return array Array with 'xfn' and 'other' keys
 */
function xfn_parse_rel_attribute( $rel_string ) {
	return XFN_Link_Extension::parse_rel_attribute( $rel_string );
}

/**
 * Helper function to combine rel values
 *
 * Provides a public interface for combining XFN and other rel values.
 *
 * @since 1.0.0
 * @param array $xfn_values Array of XFN relationship values
 * @param array $other_values Array of non-XFN rel values
 * @return string Combined rel attribute value
 */
function xfn_combine_rel_values( $xfn_values, $other_values ) {
	return XFN_Link_Extension::combine_rel_values( $xfn_values, $other_values );
}

/**
 * Helper function to validate XFN relationships
 *
 * Provides a public interface for validating XFN relationship combinations.
 *
 * @since 1.0.0
 * @param array $relationships Array of selected XFN relationships
 * @return bool Whether the relationship combination is valid
 */
function xfn_validate_relationships( $relationships ) {
	return XFN_Link_Extension::validate_xfn_relationships( $relationships );
}

/**
 * Helper function to sanitize rel attributes
 *
 * Provides a public interface for sanitizing rel attribute values.
 *
 * @since 1.0.0
 * @param string $rel_value The rel attribute value to sanitize
 * @return string Sanitized rel attribute value
 */
function xfn_sanitize_rel_attribute( $rel_value ) {
	return XFN_Link_Extension::sanitize_rel_attribute( $rel_value );
}]]></content>
  </file>
  <file path="src/block.json">
    <description>Block configuration metadata for the XFN link extension plugin.</description>
    <content><![CDATA[
  {
	"$schema": "https://schemas.wp.org/trunk/block.json",
	"apiVersion": 3,
	"name": "telex/block-xfn-link-extension",
	"version": "1.0.0",
	"title": "XFN Relationship Link Extension",
	"category": "text",
	"icon": "admin-links",
	"description": "Extends the native Gutenberg link interface to include XFN (XHTML Friends Network) relationship options across all blocks that support links.",
	"example": {},
	"supports": {
		"html": false
	},
	"textdomain": "xfn-link-extension",
	"editorScript": "file:./index.js",
	"editorStyle": "file:./index.css",
	"style": "file:./style-index.css",
	"viewScript": "file:./view.js"
}
  ]]></content>
  </file>
  <file path="src/index.js">
    <description>Main JavaScript entry point that registers the block and initializes the XFN link extension functionality.</description>
    <content><![CDATA[/**
 * WordPress dependencies
 */
import { __ } from '@wordpress/i18n';
import { addFilter } from '@wordpress/hooks';
import { PanelBody, CheckboxControl, RadioControl, TextControl, ToggleControl, Popover, Button, ButtonGroup } from '@wordpress/components';
import { InspectorControls, RichTextToolbarButton, BlockControls } from '@wordpress/block-editor';
import { createHigherOrderComponent } from '@wordpress/compose';
import { useState, useEffect } from '@wordpress/element';
import { useSelect } from '@wordpress/data';
import { link, linkOff, chevronDown, chevronUp } from '@wordpress/icons';

/**
 * Internal dependencies
 */
import './editor.scss';

/**
 * XFN Relationship definitions
 */
const XFN_RELATIONSHIPS = {
	friendship: {
		type: 'radio',
		label: __( 'Friendship', 'xfn-link-extension' ),
		description: __( 'Your friendship level (choose one)', 'xfn-link-extension' ),
		options: [
			{ label: __( 'Contact', 'xfn-link-extension' ), value: 'contact' },
			{ label: __( 'Acquaintance', 'xfn-link-extension' ), value: 'acquaintance' },
			{ label: __( 'Friend', 'xfn-link-extension' ), value: 'friend' },
		],
	},
	physical: {
		type: 'checkbox',
		label: __( 'Physical', 'xfn-link-extension' ),
		description: __( 'Have you met this person?', 'xfn-link-extension' ),
		options: [
			{ label: __( 'Met', 'xfn-link-extension' ), value: 'met' },
		],
	},
	professional: {
		type: 'checkbox',
		label: __( 'Professional', 'xfn-link-extension' ),
		description: __( 'Professional relationships', 'xfn-link-extension' ),
		options: [
			{ label: __( 'Co-worker', 'xfn-link-extension' ), value: 'co-worker' },
			{ label: __( 'Colleague', 'xfn-link-extension' ), value: 'colleague' },
		],
	},
	geographical: {
		type: 'radio',
		label: __( 'Geographical', 'xfn-link-extension' ),
		description: __( 'Geographical relationship', 'xfn-link-extension' ),
		options: [
			{ label: __( 'Co-resident', 'xfn-link-extension' ), value: 'co-resident' },
			{ label: __( 'Neighbor', 'xfn-link-extension' ), value: 'neighbor' },
		],
	},
	family: {
		type: 'radio',
		label: __( 'Family', 'xfn-link-extension' ),
		description: __( 'Family relationship', 'xfn-link-extension' ),
		options: [
			{ label: __( 'Child', 'xfn-link-extension' ), value: 'child' },
			{ label: __( 'Parent', 'xfn-link-extension' ), value: 'parent' },
			{ label: __( 'Sibling', 'xfn-link-extension' ), value: 'sibling' },
			{ label: __( 'Spouse', 'xfn-link-extension' ), value: 'spouse' },
			{ label: __( 'Kin', 'xfn-link-extension' ), value: 'kin' },
		],
	},
	romantic: {
		type: 'checkbox',
		label: __( 'Romantic', 'xfn-link-extension' ),
		description: __( 'Romantic relationships', 'xfn-link-extension' ),
		options: [
			{ label: __( 'Muse', 'xfn-link-extension' ), value: 'muse' },
			{ label: __( 'Crush', 'xfn-link-extension' ), value: 'crush' },
			{ label: __( 'Date', 'xfn-link-extension' ), value: 'date' },
			{ label: __( 'Sweetheart', 'xfn-link-extension' ), value: 'sweetheart' },
		],
	},
	identity: {
		type: 'checkbox',
		label: __( 'Identity', 'xfn-link-extension' ),
		description: __( 'Is this your own content?', 'xfn-link-extension' ),
		options: [
			{ label: __( 'Me', 'xfn-link-extension' ), value: 'me' },
		],
	},
};

/**
 * Parse rel attribute to separate XFN and non-XFN values
 */
function parseRelAttribute( relString ) {
	if ( ! relString ) {
		return { xfn: [], other: [] };
	}

	const xfnValues = [
		'contact', 'acquaintance', 'friend', 'met',
		'co-worker', 'colleague', 'co-resident', 'neighbor',
		'child', 'parent', 'sibling', 'spouse', 'kin',
		'muse', 'crush', 'date', 'sweetheart', 'me'
	];

	const relParts = relString.split( /\s+/ ).filter( Boolean );
	const xfn = [];
	const other = [];

	relParts.forEach( ( part ) => {
		if ( xfnValues.includes( part ) ) {
			xfn.push( part );
		} else {
			other.push( part );
		}
	} );

	return { xfn, other };
}

/**
 * Combine XFN and other rel values
 */
function combineRelValues( xfnValues, otherValues ) {
	const allValues = [ ...otherValues, ...xfnValues ].filter( Boolean );
	return [ ...new Set( allValues ) ].join( ' ' );
}

/**
 * Get rel attribute from various block types
 */
function getRelFromBlock( attributes, blockName ) {
	if ( attributes.rel ) {
		return attributes.rel;
	}
	
	if ( attributes.metadata?.rel ) {
		return attributes.metadata.rel;
	}
	
	return '';
}

/**
 * Set rel attribute for various block types
 */
function setRelForBlock( attributes, setAttributes, newRel, blockName ) {
	if ( attributes.hasOwnProperty( 'rel' ) ) {
		setAttributes( { rel: newRel || undefined } );
		return;
	}
	
	const metadata = attributes.metadata || {};
	setAttributes( { 
		metadata: {
			...metadata,
			rel: newRel || undefined
		}
	} );
}

/**
 * XFN Collapsible Section Component
 */
const XFNCollapsibleSection = ( { currentRel, onUpdateRel, isExpanded, onToggle } ) => {
	const { xfn: xfnValues, other: otherValues } = parseRelAttribute( currentRel );

	const updateRelationship = ( category, value, isChecked ) => {
		let newXfnValues = [ ...xfnValues ];

		if ( XFN_RELATIONSHIPS[ category ].type === 'radio' ) {
			const categoryValues = XFN_RELATIONSHIPS[ category ].options.map( opt => opt.value );
			newXfnValues = newXfnValues.filter( val => ! categoryValues.includes( val ) );

			if ( isChecked ) {
				newXfnValues.push( value );
			}
		} else {
			if ( isChecked ) {
				if ( ! newXfnValues.includes( value ) ) {
					newXfnValues.push( value );
				}
			} else {
				newXfnValues = newXfnValues.filter( val => val !== value );
			}
		}

		const newRel = combineRelValues( newXfnValues, otherValues );
		onUpdateRel( newRel );
	};

	return (
		<div className="xfn-collapsible-section">
			<Button
				className="xfn-section-toggle"
				onClick={ onToggle }
				aria-expanded={ isExpanded }
				icon={ isExpanded ? chevronUp : chevronDown }
				iconPosition="right"
				variant="tertiary"
			>
				{ __( 'XFN', 'xfn-link-extension' ) }
				{ xfnValues.length > 0 && (
					<span className="xfn-count-badge">{ xfnValues.length }</span>
				) }
			</Button>

			{ isExpanded && (
				<div className="xfn-section-content">
					<p className="xfn-section-description">
						{ __( 'Describe your relationship to this person or organization', 'xfn-link-extension' ) }
					</p>

					<div className="xfn-relationships">
						{ Object.entries( XFN_RELATIONSHIPS ).map( ( [ categoryKey, category ] ) => {
							if ( category.type === 'radio' ) {
								const selectedValue = category.options.find( opt => xfnValues.includes( opt.value ) )?.value || '';
								
								return (
									<div key={ categoryKey } className="xfn-category">
										<h4>{ category.label }</h4>
										<ButtonGroup>
											<Button
												isPressed={ selectedValue === '' }
												onClick={ () => updateRelationship( categoryKey, '', true ) }
												size="compact"
											>
												{ __( 'None', 'xfn-link-extension' ) }
											</Button>
											{ category.options.map( ( option ) => (
												<Button
													key={ option.value }
													isPressed={ selectedValue === option.value }
													onClick={ () => updateRelationship( categoryKey, option.value, true ) }
													size="compact"
												>
													{ option.label }
												</Button>
											) ) }
										</ButtonGroup>
									</div>
								);
							} else {
								return (
									<div key={ categoryKey } className="xfn-category">
										<h4>{ category.label }</h4>
										<ButtonGroup>
											{ category.options.map( ( option ) => (
												<Button
													key={ option.value }
													isPressed={ xfnValues.includes( option.value ) }
													onClick={ () => updateRelationship( categoryKey, option.value, ! xfnValues.includes( option.value ) ) }
													size="compact"
												>
													{ option.label }
												</Button>
											) ) }
										</ButtonGroup>
									</div>
								);
							}
						} ) }
					</div>

					{ xfnValues.length > 0 && (
						<div className="xfn-summary">
							<h4>{ __( 'Active Relationships:', 'xfn-link-extension' ) }</h4>
							<div className="xfn-pills">
								{ xfnValues.map( rel => (
									<span key={ rel } className={ `xfn-pill xfn-pill-${ rel }` }>
										{ rel }
									</span>
								) ) }
							</div>
						</div>
					) }
				</div>
			) }
		</div>
	);
};

/**
 * XFN Toolbar Popover Component
 */
const XFNToolbarPopover = ( { isVisible, onClose, currentRel, onUpdateRel, anchorRef } ) => {
	const [ isXFNExpanded, setXFNExpanded ] = useState( false );

	if ( ! isVisible ) {
		return null;
	}

	return (
		<Popover
			position="bottom center"
			onClose={ onClose }
			anchorRef={ anchorRef?.current }
			className="xfn-toolbar-popover"
			focusOnMount="firstElement"
		>
			<div className="xfn-toolbar-popover-content">
				<div className="xfn-toolbar-header">
					<h3>{ __( 'Link Settings', 'xfn-link-extension' ) }</h3>
				</div>

				<XFNCollapsibleSection
					currentRel={ currentRel }
					onUpdateRel={ onUpdateRel }
					isExpanded={ isXFNExpanded }
					onToggle={ () => setXFNExpanded( ! isXFNExpanded ) }
				/>
			</div>
		</Popover>
	);
};

/**
 * XFN Inspector Controls Component (for blocks that are entirely links)
 */
const XFNInspectorControls = ( { attributes, setAttributes, name } ) => {
	const currentRel = getRelFromBlock( attributes, name );
	const { xfn: xfnValues, other: otherValues } = parseRelAttribute( currentRel );

	const updateXFNValues = ( newXfnValues ) => {
		const newRel = combineRelValues( newXfnValues, otherValues );
		setRelForBlock( attributes, setAttributes, newRel, name );
	};

	const updateRelationship = ( category, value, isChecked ) => {
		let newXfnValues = [ ...xfnValues ];

		if ( XFN_RELATIONSHIPS[ category ].type === 'radio' ) {
			const categoryValues = XFN_RELATIONSHIPS[ category ].options.map( opt => opt.value );
			newXfnValues = newXfnValues.filter( val => ! categoryValues.includes( val ) );

			if ( isChecked ) {
				newXfnValues.push( value );
			}
		} else {
			if ( isChecked ) {
				if ( ! newXfnValues.includes( value ) ) {
					newXfnValues.push( value );
				}
			} else {
				newXfnValues = newXfnValues.filter( val => val !== value );
			}
		}

		updateXFNValues( newXfnValues );
	};

	return (
		<InspectorControls>
			<PanelBody
				title={ __( 'XFN Relationships', 'xfn-link-extension' ) }
				initialOpen={ false }
				className="xfn-inspector-panel"
			>
				<p className="xfn-panel-description">
					{ __( 'Describe your relationship to the people or organizations you link to using XFN (XHTML Friends Network) markup.', 'xfn-link-extension' ) }
				</p>

				{ Object.entries( XFN_RELATIONSHIPS ).map( ( [ categoryKey, category ] ) => {
					if ( category.type === 'radio' ) {
						const selectedValue = category.options.find( opt => xfnValues.includes( opt.value ) )?.value || '';
						const radioOptions = [
							{ label: __( 'None', 'xfn-link-extension' ), value: '' },
							...category.options
						];

						return (
							<div key={ categoryKey } className="xfn-category-section">
								<RadioControl
									label={ category.label }
									help={ category.description }
									selected={ selectedValue }
									options={ radioOptions }
									onChange={ ( value ) => {
										updateRelationship( categoryKey, value, value !== '' );
									} }
								/>
							</div>
						);
					} else {
						return (
							<div key={ categoryKey } className="xfn-category-section">
								<h4 className="xfn-category-title">{ category.label }</h4>
								<p className="xfn-category-help">{ category.description }</p>
								{ category.options.map( ( option ) => (
									<CheckboxControl
										key={ option.value }
										label={ option.label }
										checked={ xfnValues.includes( option.value ) }
										onChange={ ( isChecked ) => {
											updateRelationship( categoryKey, option.value, isChecked );
										} }
									/>
								) ) }
							</div>
						);
				}
			} ) }

				{ xfnValues.length > 0 && (
					<div className="xfn-selected-summary">
						<h4>{ __( 'Selected Relationships:', 'xfn-link-extension' ) }</h4>
						<div className="xfn-pills">
							{ xfnValues.map( rel => (
								<span key={ rel } className={ `xfn-pill xfn-pill-${ rel }` }>
									{ rel }
								</span>
							) ) }
						</div>
					</div>
				) }
			</PanelBody>
		</InspectorControls>
	);
};

/**
 * Global state to track XFN editing mode
 */
let isXFNEditingActive = false;
let currentXFNValues = [];
let currentOtherValues = [];

/**
 * Inject XFN controls into LinkControl Advanced panel
 */
function injectXFNControls() {
	// Wait for link controls to be available
	setTimeout( () => {
		const linkControls = document.querySelector( '.block-editor-link-control' );
		if ( ! linkControls ) {
			return;
		}

		// Look for the Advanced panel
		const advancedToggle = linkControls.querySelector( '.block-editor-link-control__tools .components-button' );
		if ( ! advancedToggle ) {
			return;
		}

		// Check if Advanced panel is expanded
		const isAdvancedOpen = advancedToggle.getAttribute( 'aria-expanded' ) === 'true';
		if ( ! isAdvancedOpen ) {
			return;
		}

		// Look for the settings panel container
		const settingsPanel = linkControls.querySelector( '.block-editor-link-control__settings' );
		if ( ! settingsPanel ) {
			return;
		}

		// Check if XFN controls are already injected
		if ( settingsPanel.querySelector( '.xfn-collapsible-section' ) ) {
			return;
		}

		// Get current rel value from the link control
		const relInput = linkControls.querySelector( 'input[type="text"][placeholder*="rel"], input[id*="rel"]' );
		const currentRel = relInput ? relInput.value : '';
		const { xfn: xfnValues, other: otherValues } = parseRelAttribute( currentRel );

		currentXFNValues = [ ...xfnValues ];
		currentOtherValues = [ ...otherValues ];

		// Create XFN collapsible section
		const xfnContainer = document.createElement( 'div' );
		xfnContainer.className = 'xfn-collapsible-section';
		xfnContainer.innerHTML = createXFNCollapsibleHTML( currentXFNValues );

		// Insert XFN controls after existing controls
		settingsPanel.appendChild( xfnContainer );

		// Add event listeners
		addXFNEventListeners( xfnContainer, relInput );
	}, 100 );
}

/**
 * Create HTML for XFN collapsible section
 */
function createXFNCollapsibleHTML( xfnValues ) {
	const countBadge = xfnValues.length > 0 ? `<span class="xfn-count-badge">${xfnValues.length}</span>` : '';
	
	let html = `
		<button 
			class="xfn-section-toggle components-button is-tertiary" 
			aria-expanded="false" 
			type="button"
		>
			XFN ${countBadge}
			<svg class="xfn-chevron" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
				<path d="M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"/>
			</svg>
		</button>
		<div class="xfn-section-content" style="display: none;">
			<p class="xfn-section-description">
				${ __( 'Describe your relationship to this person or organization', 'xfn-link-extension' ) }
			</p>
	`;

	Object.entries( XFN_RELATIONSHIPS ).forEach( ( [ categoryKey, category ] ) => {
		html += `<div class="xfn-category" data-category="${categoryKey}">`;
		html += `<h4>${category.label}</h4>`;

		if ( category.type === 'radio' ) {
			const selectedValue = category.options.find( opt => xfnValues.includes( opt.value ) )?.value || '';
			
			html += `<div class="xfn-button-group">`;
			html += `<button class="components-button is-compact ${selectedValue === '' ? 'is-pressed' : ''}" data-value="">${ __( 'None', 'xfn-link-extension' ) }</button>`;
			
			category.options.forEach( option => {
				html += `<button class="components-button is-compact ${selectedValue === option.value ? 'is-pressed' : ''}" data-value="${option.value}">${option.label}</button>`;
			} );
			html += `</div>`;
		} else {
			html += `<div class="xfn-button-group">`;
			category.options.forEach( option => {
				const isPressed = xfnValues.includes( option.value );
				html += `<button class="components-button is-compact ${isPressed ? 'is-pressed' : ''}" data-value="${option.value}">${option.label}</button>`;
			} );
			html += `</div>`;
		}

		html += `</div>`;
	} );

	// Add summary if there are selected relationships
	if ( xfnValues.length > 0 ) {
		html += `<div class="xfn-summary">`;
		html += `<h4>${ __( 'Active Relationships:', 'xfn-link-extension' ) }</h4>`;
		html += `<div class="xfn-pills">`;
		xfnValues.forEach( rel => {
			html += `<span class="xfn-pill xfn-pill-${rel}">${rel}</span>`;
		} );
		html += `</div></div>`;
	}

	html += `</div>`;

	return html;
}

/**
 * Add event listeners to XFN collapsible section
 */
function addXFNEventListeners( container, relInput ) {
	const toggle = container.querySelector( '.xfn-section-toggle' );
	const content = container.querySelector( '.xfn-section-content' );
	const chevron = toggle.querySelector( '.xfn-chevron' );

	const updateRelAttribute = () => {
		const newRel = combineRelValues( currentXFNValues, currentOtherValues );
		if ( relInput ) {
			relInput.value = newRel;
			relInput.dispatchEvent( new Event( 'input', { bubbles: true } ) );
		}
		
		// Update the visual summary and count badge
		updateXFNSummary( container );
		updateCountBadge( toggle );
	};

	// Toggle functionality
	toggle.addEventListener( 'click', ( e ) => {
		e.preventDefault();
		const isExpanded = toggle.getAttribute( 'aria-expanded' ) === 'true';
		const newState = ! isExpanded;
		
		toggle.setAttribute( 'aria-expanded', newState );
		content.style.display = newState ? 'block' : 'none';
		chevron.style.transform = newState ? 'rotate(180deg)' : 'rotate(0deg)';
	} );

	// Handle button clicks
	container.querySelectorAll( '.xfn-button-group .components-button' ).forEach( button => {
		button.addEventListener( 'click', ( e ) => {
			e.preventDefault();
			const category = e.target.closest( '.xfn-category' ).dataset.category;
			const value = e.target.dataset.value;
			const buttonGroup = e.target.closest( '.xfn-button-group' );
			
			if ( XFN_RELATIONSHIPS[ category ].type === 'radio' ) {
				// Remove all values from this category
				const categoryValues = XFN_RELATIONSHIPS[ category ].options.map( opt => opt.value );
				currentXFNValues = currentXFNValues.filter( val => ! categoryValues.includes( val ) );
				
				// Add new value if not empty
				if ( value ) {
					currentXFNValues.push( value );
				}
				
				// Update button states in group
				buttonGroup.querySelectorAll( '.components-button' ).forEach( btn => {
					btn.classList.remove( 'is-pressed' );
				} );
				e.target.classList.add( 'is-pressed' );
			} else {
				// Toggle checkbox behavior
				const isPressed = e.target.classList.contains( 'is-pressed' );
				
				if ( isPressed ) {
					currentXFNValues = currentXFNValues.filter( val => val !== value );
					e.target.classList.remove( 'is-pressed' );
				} else {
					if ( ! currentXFNValues.includes( value ) ) {
						currentXFNValues.push( value );
					}
					e.target.classList.add( 'is-pressed' );
				}
			}
			
			updateRelAttribute();
		} );
	} );
}

/**
 * Update XFN visual summary
 */
function updateXFNSummary( container ) {
	let summaryContainer = container.querySelector( '.xfn-summary' );
	
	if ( currentXFNValues.length === 0 ) {
		if ( summaryContainer ) {
			summaryContainer.remove();
		}
		return;
	}

	if ( ! summaryContainer ) {
		summaryContainer = document.createElement( 'div' );
		summaryContainer.className = 'xfn-summary';
		container.querySelector( '.xfn-section-content' ).appendChild( summaryContainer );
	}

	let html = `<h4>${ __( 'Active Relationships:', 'xfn-link-extension' ) }</h4>`;
	html += `<div class="xfn-pills">`;
	currentXFNValues.forEach( rel => {
		html += `<span class="xfn-pill xfn-pill-${rel}">${rel}</span>`;
	} );
	html += `</div>`;

	summaryContainer.innerHTML = html;
}

/**
 * Update count badge in toggle button
 */
function updateCountBadge( toggle ) {
	let badge = toggle.querySelector( '.xfn-count-badge' );
	
	if ( currentXFNValues.length === 0 ) {
		if ( badge ) {
			badge.remove();
		}
		return;
	}

	if ( ! badge ) {
		badge = document.createElement( 'span' );
		badge.className = 'xfn-count-badge';
		toggle.insertBefore( badge, toggle.querySelector( '.xfn-chevron' ) );
	}

	badge.textContent = currentXFNValues.length;
}

/**
 * Monitor for link control changes and inject XFN controls
 */
function startXFNMonitoring() {
	const observer = new MutationObserver( ( mutations ) => {
		mutations.forEach( ( mutation ) => {
			if ( mutation.type === 'childList' ) {
				const addedNodes = Array.from( mutation.addedNodes );
				
				// Check if link control was added
				addedNodes.forEach( node => {
					if ( node.nodeType === Node.ELEMENT_NODE ) {
						if ( node.classList?.contains( 'block-editor-link-control' ) || 
							 node.querySelector?.( '.block-editor-link-control' ) ) {
							injectXFNControls();
						}

						// Check for advanced settings expansion
						if ( node.classList?.contains( 'block-editor-link-control__settings' ) ||
							 node.querySelector?.( '.block-editor-link-control__settings' ) ) {
							injectXFNControls();
						}
					}
				} );
			}
			
			// Also check for attribute changes that might indicate advanced panel expansion
			if ( mutation.type === 'attributes' && mutation.attributeName === 'aria-expanded' ) {
				injectXFNControls();
			}
		} );
	} );

	observer.observe( document.body, {
		childList: true,
		subtree: true,
		attributes: true,
		attributeFilter: [ 'aria-expanded' ]
	} );

	// Also monitor clicks on advanced toggle buttons
	document.addEventListener( 'click', ( e ) => {
		if ( e.target.closest( '.block-editor-link-control__tools .components-button' ) ) {
			setTimeout( injectXFNControls, 50 );
		}
	} );
}

/**
 * Filter to add XFN controls to blocks that are entirely links
 */
const withXFNControls = createHigherOrderComponent( ( BlockEdit ) => {
	return ( props ) => {
		const { attributes, name } = props;
		const [ isXFNPopoverVisible, setXFNPopoverVisible ] = useState( false );
		const xfnButtonRef = useState( null );

		// List of blocks that support links as the entire block
		const supportedBlocks = [
			'core/button',
			'core/image', 
			'core/navigation-link',
			'core/site-logo',
			'core/post-title',
			'core/query-title'
		];

		// Check if this block type should have XFN controls in inspector
		const shouldShowXFN = supportedBlocks.includes( name ) || 
							  attributes.hasOwnProperty( 'url' ) || 
							  attributes.hasOwnProperty( 'href' ) ||
							  attributes.hasOwnProperty( 'linkDestination' );

		if ( ! shouldShowXFN ) {
			return <BlockEdit { ...props } />;
		}

		const currentRel = getRelFromBlock( attributes, name );

		const handleXFNUpdate = ( newRel ) => {
			setRelForBlock( attributes, props.setAttributes, newRel, name );
		};

		return (
			<>
				<BlockEdit { ...props } />
				<XFNInspectorControls { ...props } />
				<BlockControls>
					<Button
						ref={ xfnButtonRef[0] }
						icon={ link }
						label={ __( 'XFN Relationships', 'xfn-link-extension' ) }
						onClick={ () => setXFNPopoverVisible( ! isXFNPopoverVisible ) }
						isPressed={ isXFNPopoverVisible }
						className="xfn-toolbar-button"
					>
						{ __( 'XFN', 'xfn-link-extension' ) }
					</Button>
				</BlockControls>
				<XFNToolbarPopover
					isVisible={ isXFNPopoverVisible }
					onClose={ () => setXFNPopoverVisible( false ) }
					currentRel={ currentRel }
					onUpdateRel={ handleXFNUpdate }
					anchorRef={ xfnButtonRef[0] }
				/>
			</>
		);
	};
}, 'withXFNControls' );

// Apply the filter for block-level links
addFilter(
	'editor.BlockEdit',
	'xfn-link-extension/with-xfn-controls',
	withXFNControls
);

// Start monitoring for inline links
if ( typeof document !== 'undefined' ) {
	// Wait for editor to be ready
	setTimeout( startXFNMonitoring, 1000 );
}

console.log( 'XFN Link Extension loaded successfully! XFN controls will appear:' );
console.log( '1. In the floating toolbar for link blocks (Button, Navigation, etc.)' );
console.log( '2. In Inspector Controls for link blocks' );
console.log( '3. In a collapsible XFN section in link popovers for inline links' );]]></content>
  </file>
  <file path="src/edit.js">
    <description>Edit component for the XFN link extension - not used as this is a link enhancement plugin rather than a block.</description>
    <content><![CDATA[
  /**
 * This file is not used in the XFN Link Extension plugin.
 * 
 * The plugin extends existing link functionality rather than creating
 * a new block type, so no edit component is needed.
 * 
 * The functionality is implemented through WordPress filters that enhance
 * the existing LinkControl component across all blocks that support links.
 */

export default function Edit() {
	return null;
}
	]]></content>
  </file>
  <file path="src/save.js">
    <description>Save component for the XFN link extension - not used as this enhances existing link functionality.</description>
    <content><![CDATA[
  /**
 * This file is not used in the XFN Link Extension plugin.
 * 
 * The plugin enhances existing link functionality by modifying rel attributes
 * rather than creating new block content, so no save function is needed.
 * 
 * XFN relationships are stored in standard HTML rel attributes that are
 * handled by WordPress core's existing link serialization.
 */

export default function save() {
	return null;
}
	]]></content>
  </file>
  <file path="src/style.scss">
    <description>Frontend styles for XFN link extension - minimal since this only affects the editor interface.</description>
    <content><![CDATA[/**
 * Frontend styles for XFN Link Extension
 *
 * This plugin primarily affects the editor interface, so minimal frontend
 * styles are needed. XFN relationships are semantic HTML attributes that
 * don't require visual styling by default.
 */

/* 
 * Optional: Style links that contain XFN relationships
 * These styles are not required but can be used by themes that want
 * to provide visual indicators for XFN-enhanced links.
 */

/* Links with any XFN relationship */
a.has-xfn-relationships {
	/* Base styling for all XFN links - themes can customize */
}

/* Specific relationship styling examples */
a[rel*="friend"] {
	/* Friend links */
}

a[rel*="colleague"], 
a[rel*="co-worker"] {
	/* Professional links */
}

a[rel*="spouse"],
a[rel*="child"],
a[rel*="parent"],
a[rel*="sibling"],
a[rel*="kin"] {
	/* Family links */
}

a[rel*="me"] {
	/* Self links */
}

/*
 * Accessibility: Ensure any custom styling maintains proper contrast ratios
 * and doesn't interfere with focus indicators or screen reader functionality.
 */

/* Ensure focus indicators are preserved */
a.has-xfn-relationships:focus {
	/* Maintain focus styling */
}

/* Print styles */
@media print {
	a.has-xfn-relationships::after {
		/* Could add relationship indicators in print */
	}
}]]></content>
  </file>
  <file path="src/editor.scss">
    <description>Editor-specific styles for the XFN relationship interface in the WordPress block editor.</description>
    <content><![CDATA[/**
 * Editor styles for XFN Link Extension
 * Inspector Controls, Link Control Integration, AND Toolbar Popover with Collapsible Section
 */

/* XFN Inspector Panel */
.xfn-inspector-panel {
	.components-panel__body-content {
		padding-top: 0;
	}
}

.xfn-panel-description {
	font-size: 13px;
	color: #757575;
	margin: 0 0 16px 0;
	line-height: 1.4;
}

/* XFN Category Sections */
.xfn-category-section {
	margin-bottom: 20px;
	padding-bottom: 16px;
	border-bottom: 1px solid #e0e0e0;

	&:last-child {
		border-bottom: none;
		margin-bottom: 0;
	}
}

.xfn-category-title {
	font-size: 13px;
	font-weight: 600;
	color: #1e1e1e;
	margin: 0 0 6px 0;
	line-height: 1.3;
}

.xfn-category-help {
	font-size: 12px;
	color: #757575;
	margin: 0 0 12px 0;
	line-height: 1.3;
}

/* WordPress Component Overrides */
.xfn-category-section .components-radio-control {
	margin-bottom: 0;

	.components-radio-control__option {
		margin-bottom: 6px;
		font-size: 13px;

		&:last-child {
			margin-bottom: 0;
		}
	}

	.components-base-control__help {
		font-size: 12px;
		color: #757575;
		margin-top: 4px;
	}
}

.xfn-category-section .components-checkbox-control {
	margin-bottom: 8px;
	font-size: 13px;

	&:last-child {
		margin-bottom: 0;
	}

	.components-checkbox-control__label {
		font-size: 13px;
	}
}

/* Selected Relationships Summary */
.xfn-selected-summary {
	margin-top: 20px;
	padding: 16px;
	background: #e7f3ff;
	border: 1px solid #b3d9ff;
	border-radius: 4px;

	h4 {
		font-size: 13px;
		font-weight: 600;
		color: #1e1e1e;
		margin: 0 0 8px 0;
		line-height: 1.3;
	}
}

.xfn-pills {
	display: flex;
	flex-wrap: wrap;
	gap: 6px;
}

.xfn-pill {
	display: inline-block;
	padding: 4px 8px;
	font-size: 10px;
	font-weight: 500;
	background: #0073aa;
	color: white;
	border-radius: 12px;
	text-transform: uppercase;
	letter-spacing: 0.5px;
	line-height: 1.2;
}

/* Category-specific pill colors */
.xfn-pill-friend,
.xfn-pill-acquaintance,
.xfn-pill-contact {
	background: #00a32a;
}

.xfn-pill-met {
	background: #826eb4;
}

.xfn-pill-co-worker,
.xfn-pill-colleague {
	background: #d63638;
}

.xfn-pill-co-resident,
.xfn-pill-neighbor {
	background: #dba617;
}

.xfn-pill-child,
.xfn-pill-parent,
.xfn-pill-sibling,
.xfn-pill-spouse,
.xfn-pill-kin {
	background: #ff6900;
}

.xfn-pill-muse,
.xfn-pill-crush,
.xfn-pill-date,
.xfn-pill-sweetheart {
	background: #e91e63;
}

.xfn-pill-me {
	background: #1e1e1e;
}

/* === TOOLBAR POPOVER STYLES === */

.xfn-toolbar-button {
	min-width: 48px;
	justify-content: center;
	font-size: 12px;
	font-weight: 600;
}

.xfn-toolbar-popover {
	z-index: 1000001;

	.components-popover__content {
		min-width: 320px;
		max-width: 400px;
		padding: 0;
		border-radius: 6px;
		box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
	}
}

.xfn-toolbar-popover-content {
	padding: 16px;
	max-height: 400px;
	overflow-y: auto;
}

.xfn-toolbar-header {
	margin-bottom: 16px;
	padding-bottom: 12px;
	border-bottom: 1px solid #e0e0e0;

	h3 {
		font-size: 14px;
		font-weight: 600;
		color: #1e1e1e;
		margin: 0;
		line-height: 1.3;
	}
}

/* === COLLAPSIBLE SECTION STYLES === */

.xfn-collapsible-section {
	border: 1px solid #e0e0e0;
	border-radius: 4px;
	background: #fff;
	overflow: hidden;
}

.xfn-section-toggle {
	display: flex !important;
	align-items: center;
	justify-content: space-between;
	width: 100%;
	padding: 12px 16px;
	background: #f8f9fa;
	border: none;
	border-bottom: 1px solid #e0e0e0;
	font-size: 13px;
	font-weight: 600;
	color: #1e1e1e;
	cursor: pointer;
	transition: background-color 0.15s ease;
	text-align: left;

	&:hover {
		background: #f0f0f0;
		color: #0073aa;
	}

	&:focus {
		box-shadow: inset 0 0 0 1px #0073aa;
		outline: none;
	}

	&[aria-expanded="true"] {
		background: #f0f8ff;
		color: #0073aa;
		border-bottom-color: #b3d9ff;

		.xfn-chevron {
			transform: rotate(180deg);
		}
	}
}

.xfn-count-badge {
	display: inline-block;
	margin-left: 8px;
	padding: 2px 6px;
	background: #0073aa;
	color: white;
	font-size: 10px;
	font-weight: 500;
	border-radius: 8px;
	min-width: 16px;
	text-align: center;
	line-height: 1.2;
}

.xfn-chevron {
	width: 18px;
	height: 18px;
	transition: transform 0.2s ease;
	flex-shrink: 0;
	fill: currentColor;
}

.xfn-section-content {
	padding: 16px;
	animation: xfn-expand 0.2s ease-out;

	&[style*="display: none"] {
		animation: xfn-collapse 0.15s ease-in;
	}
}

.xfn-section-description {
	font-size: 12px;
	color: #757575;
	margin: 0 0 16px 0;
	line-height: 1.4;
}

.xfn-relationships {
	display: flex;
	flex-direction: column;
	gap: 16px;
}

.xfn-category {
	h4 {
		font-size: 12px;
		font-weight: 600;
		color: #1e1e1e;
		margin: 0 0 8px 0;
		line-height: 1.3;
	}

	.components-button-group,
	.xfn-button-group {
		display: flex;
		flex-wrap: wrap;
		gap: 4px;
		align-items: flex-start;

		.components-button {
			font-size: 11px;
			padding: 4px 8px;
			height: auto;
			min-height: 28px;
			border-radius: 14px;
			border: 1px solid #ddd;
			background: #fff;
			color: #1e1e1e;
			transition: all 0.15s ease;
			flex: 0 0 auto;

			&:hover {
				color: #0073aa;
				border-color: #0073aa;
				background: #f0f8ff;
			}

			&.is-pressed {
				background: #0073aa;
				color: white;
				border-color: #0073aa;
				font-weight: 500;
			}

			&:focus {
				box-shadow: 0 0 0 2px rgba(0, 115, 170, 0.3);
			}
		}
	}
}

.xfn-summary {
	margin-top: 16px;
	padding: 12px;
	background: #f6f7f7;
	border: 1px solid #e0e0e0;
	border-radius: 4px;

	h4 {
		font-size: 11px;
		font-weight: 600;
		color: #1e1e1e;
		margin: 0 0 6px 0;
		line-height: 1.3;
		text-transform: uppercase;
		letter-spacing: 0.5px;
	}

	.xfn-pills {
		gap: 4px;
		
		.xfn-pill {
			font-size: 9px;
			padding: 3px 6px;
			border-radius: 10px;
		}
	}
}

/* === LINK CONTROL INTEGRATION STYLES === */

/* XFN Controls in Link Control Advanced Panel */
.block-editor-link-control .xfn-collapsible-section {
	margin-top: 16px;
	border-color: #ddd;
}

.block-editor-link-control .xfn-section-toggle {
	background: #f9f9f9;
	border-bottom-color: #ddd;

	&:hover {
		background: #f0f0f0;
	}

	&[aria-expanded="true"] {
		background: #f0f8ff;
		border-bottom-color: #b3d9ff;
	}
}

.block-editor-link-control .xfn-section-content {
	padding: 12px;
}

.block-editor-link-control .xfn-category {
	margin-bottom: 12px;

	&:last-child {
		margin-bottom: 0;
	}

	h4 {
		font-size: 11px;
		margin-bottom: 6px;
	}
}

.block-editor-link-control .xfn-summary {
	margin-top: 12px;
	padding: 8px 10px;
	background: #f6f7f7;

	h4 {
		font-size: 10px;
		margin-bottom: 4px;
	}

	.xfn-pills {
		gap: 3px;

		.xfn-pill {
			font-size: 8px;
			padding: 2px 5px;
		}
	}
}

.block-editor-link-control .xfn-relationships {
	gap: 12px;
}

/* Focus styles for accessibility */
.xfn-radio-group input:focus,
.xfn-checkbox-group input:focus {
	box-shadow: 0 0 0 2px #0073aa;
	border-radius: 2px;
}

.xfn-radio-group label:focus-within,
.xfn-checkbox-group label:focus-within {
	color: #0073aa;
	font-weight: 500;
}

/* Accessibility improvements */
.xfn-category-section .components-radio-control__option input:focus + label,
.xfn-category-section .components-checkbox-control input:focus + .components-checkbox-control__label {
	box-shadow: 0 0 0 1px #0073aa;
	border-radius: 2px;
}

/* Ensure toolbar button is properly styled */
.block-editor-block-controls .xfn-toolbar-button {
	position: relative;

	&.is-pressed {
		background: #0073aa;
		color: white;
	}

	&:focus {
		box-shadow: inset 0 0 0 1px #fff, 0 0 0 1.5px #0073aa;
	}
}

/* High contrast mode support */
@media (prefers-contrast: high) {
	.xfn-selected-summary,
	.xfn-summary {
		border-color: #000;
		background: #fff;
	}

	.xfn-pill {
		border: 1px solid #000;
	}

	.xfn-category-section,
	.xfn-collapsible-section,
	.xfn-toolbar-header {
		border-color: #000;
	}

	.xfn-section-toggle {
		border-color: #000;
		background: #fff;
		color: #000;

		&:hover,
		&[aria-expanded="true"] {
			background: #000;
			color: #fff;
		}
	}

	.xfn-category .components-button {
		border-color: #000;

		&.is-pressed {
			background: #000;
			color: #fff;
			border-color: #000;
		}
	}
}

/* Responsive adjustments */
@media (max-width: 600px) {
	.xfn-pills {
		flex-direction: column;
		align-items: flex-start;
	}

	.xfn-toolbar-popover .components-popover__content {
		min-width: 280px;
		max-width: 320px;
	}

	.xfn-category .components-button-group,
	.xfn-category .xfn-button-group {
		flex-direction: column;
		align-items: stretch;

		.components-button {
			justify-content: flex-start;
		}
	}

	.xfn-section-toggle {
		padding: 10px 12px;
		font-size: 12px;
	}

	.xfn-section-content {
		padding: 12px;
	}
}

/* Animation keyframes */
@keyframes xfn-expand {
	from {
		opacity: 0;
		max-height: 0;
		transform: translateY(-5px);
	}
	to {
		opacity: 1;
		max-height: 500px;
		transform: translateY(0);
	}
}

@keyframes xfn-collapse {
	from {
		opacity: 1;
		max-height: 500px;
	}
	to {
		opacity: 0;
		max-height: 0;
	}
}

@keyframes xfn-fade-in {
	from {
		opacity: 0;
		transform: translateY(-5px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
}

@keyframes xfn-slide-in {
	from {
		opacity: 0;
		transform: scale(0.95) translateY(-10px);
	}
	to {
		opacity: 1;
		transform: scale(1) translateY(0);
	}
}

/* Animation for smooth appearance */
.xfn-selected-summary,
.xfn-summary {
	animation: xfn-fade-in 0.2s ease-out;
}

.xfn-toolbar-popover-content {
	animation: xfn-slide-in 0.2s ease-out;
}

/* Ensure panels have proper spacing */
.xfn-inspector-panel .components-panel__body-content > *:first-child {
	margin-top: 0;
}

.xfn-inspector-panel .components-panel__body-content > *:last-child {
	margin-bottom: 0;
}

/* Ensure XFN controls don't interfere with existing link control styling */
.block-editor-link-control .xfn-collapsible-section {
	border-top-color: #ddd;
}

/* Scrollbar styling for toolbar popover */
.xfn-toolbar-popover-content::-webkit-scrollbar {
	width: 6px;
}

.xfn-toolbar-popover-content::-webkit-scrollbar-track {
	background: #f1f1f1;
	border-radius: 3px;
}

.xfn-toolbar-popover-content::-webkit-scrollbar-thumb {
	background: #c1c1c1;
	border-radius: 3px;
}

.xfn-toolbar-popover-content::-webkit-scrollbar-thumb:hover {
	background: #a1a1a1;
}

/* Ensure proper toggle button layout */
.xfn-section-toggle {
	display: flex;
	align-items: center;
	justify-content: space-between;
	gap: 8px;
}

.xfn-section-toggle .xfn-count-badge {
	margin-left: auto;
	margin-right: 8px;
}

/* Improve button group spacing in collapsible sections */
.xfn-collapsible-section .xfn-button-group {
	gap: 6px;
}

.xfn-collapsible-section .xfn-button-group .components-button {
	font-size: 10px;
	padding: 3px 7px;
	min-height: 24px;
	border-radius: 12px;
}

/* Ensure proper nesting in link control context */
.block-editor-link-control__settings .xfn-collapsible-section {
	margin-top: 12px;
}

/* Make collapsible sections look consistent with WordPress design */
.xfn-collapsible-section {
	border-radius: 2px;
	overflow: hidden;
}

.xfn-section-toggle {
	border-radius: 0;
}]]></content>
  </file>
  <file path="src/view.js">
    <description>Frontend JavaScript for XFN link extension - minimal since this is primarily an editor enhancement.</description>
    <content><![CDATA[/**
 * Frontend JavaScript for XFN Link Extension
 *
 * This plugin primarily enhances the editor interface, so minimal frontend
 * JavaScript is required. XFN relationships are semantic HTML attributes
 * that work without JavaScript.
 */

( function() {
	'use strict';

	/**
	 * Initialize XFN frontend functionality
	 */
	function initXFNFrontend() {
		// Optional: Add analytics tracking for XFN relationships
		trackXFNUsage();
		
		// Optional: Add accessibility enhancements
		enhanceXFNAccessibility();
	}

	/**
	 * Track XFN usage for analytics (optional)
	 */
	function trackXFNUsage() {
		const xfnLinks = document.querySelectorAll( 'a[rel]' );
		
		if ( xfnLinks.length === 0 ) {
			return;
		}

		// Count different types of XFN relationships
		const relationshipCounts = {
			friendship: 0,
			professional: 0,
			family: 0,
			romantic: 0,
			identity: 0,
			met: 0
		};

		xfnLinks.forEach( function( link ) {
			const rel = link.getAttribute( 'rel' ) || '';
			
			// Check for friendship relationships
			if ( /\b(contact|acquaintance|friend)\b/.test( rel ) ) {
				relationshipCounts.friendship++;
			}
			
			// Check for professional relationships
			if ( /\b(co-worker|colleague)\b/.test( rel ) ) {
				relationshipCounts.professional++;
			}
			
			// Check for family relationships
			if ( /\b(child|parent|sibling|spouse|kin)\b/.test( rel ) ) {
				relationshipCounts.family++;
			}
			
			// Check for romantic relationships
			if ( /\b(muse|crush|date|sweetheart)\b/.test( rel ) ) {
				relationshipCounts.romantic++;
			}
			
			// Check for identity relationships
			if ( /\bme\b/.test( rel ) ) {
				relationshipCounts.identity++;
			}
			
			// Check for met relationship
			if ( /\bmet\b/.test( rel ) ) {
				relationshipCounts.met++;
			}
		} );

		// Log usage statistics for debugging
		console.log( 'XFN Usage Statistics:', {
			totalLinks: xfnLinks.length,
			...relationshipCounts
		} );
	}

	/**
	 * Enhance XFN links with accessibility features (optional)
	 */
	function enhanceXFNAccessibility() {
		const xfnLinks = document.querySelectorAll( 'a[rel]' );
		
		xfnLinks.forEach( function( link ) {
			const rel = link.getAttribute( 'rel' ) || '';
			const xfnRelationships = extractXFNRelationships( rel );
			
			if ( xfnRelationships.length === 0 ) {
				return;
			}

			// Add data attributes for CSS styling
			link.setAttribute( 'data-xfn-relationships', xfnRelationships.join( ' ' ) );
			link.classList.add( 'has-xfn-relationships' );
		} );
	}

	/**
	 * Extract XFN relationships from a rel attribute
	 */
	function extractXFNRelationships( rel ) {
		const xfnValues = [
			'contact', 'acquaintance', 'friend', 'met',
			'co-worker', 'colleague', 'co-resident', 'neighbor',
			'child', 'parent', 'sibling', 'spouse', 'kin',
			'muse', 'crush', 'date', 'sweetheart', 'me'
		];

		const relParts = rel.split( /\s+/ );
		return relParts.filter( function( part ) {
			return xfnValues.indexOf( part ) !== -1;
		} );
	}

	// Initialize when DOM is ready
	if ( document.readyState === 'loading' ) {
		document.addEventListener( 'DOMContentLoaded', initXFNFrontend );
	} else {
		initXFNFrontend();
	}

} )();]]></content>
  </file>
  
</artefact>